{
  "comments": [
    {
      "unresolved": true,
      "key": {
        "uuid": "86fb0d95_cfa90364",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 2
      },
      "lineNbr": 0,
      "author": {
        "id": 1480888
      },
      "writtenOn": "2024-03-27T20:41:03Z",
      "side": 1,
      "message": "Might be worth building out the entire stack of CLs and we can rework git history to land the no-nop first.",
      "revId": "8b37937a5f2a6e626e07abf34eb21d1adf6466d2",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "111a0bd2_1f04b415",
        "filename": "envsetup.sh",
        "patchSetId": 2
      },
      "lineNbr": 1104,
      "author": {
        "id": 1000701
      },
      "writtenOn": "2024-03-27T20:57:18Z",
      "side": 1,
      "message": "Do you want to do it before calling adb so that if the user cancels you still get the logs?",
      "revId": "8b37937a5f2a6e626e07abf34eb21d1adf6466d2",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "39de1fea_8d38d839",
        "filename": "envsetup.sh",
        "patchSetId": 2
      },
      "lineNbr": 1104,
      "author": {
        "id": 1480888
      },
      "writtenOn": "2024-03-27T22:40:05Z",
      "side": 1,
      "message": "Yeah that\u0027s why I had sort of split it with a begin/end. That way we can tell which invocations were killed because they have no end. I guess we could trap the signal and what not.\n\nWrapping the execution in a function allows us to change how we do this though. We could start out simple and expand.\n\nI have no real opinion on this though.",
      "parentUuid": "111a0bd2_1f04b415",
      "revId": "8b37937a5f2a6e626e07abf34eb21d1adf6466d2",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "fcb6d477_765a22c7",
        "filename": "envsetup.sh",
        "patchSetId": 2
      },
      "lineNbr": 1104,
      "author": {
        "id": 1114063
      },
      "writtenOn": "2024-03-27T23:19:05Z",
      "side": 1,
      "message": "This is my plan to collect and upload log: https://android-review.git.corp.google.com/c/platform/build/+/3018404\n\nI record the timestamp ate the begin/end of the ADB call and also the exit code and then pass it to the uploader to generate the log proto and upload to clearcut. \n\nIn case the user cancel the ADB run, we should get an exit code 130 and still upload the start and exit event.",
      "parentUuid": "39de1fea_8d38d839",
      "revId": "8b37937a5f2a6e626e07abf34eb21d1adf6466d2",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "26e14111_d7c68cb6",
        "filename": "envsetup.sh",
        "patchSetId": 2
      },
      "lineNbr": 1104,
      "author": {
        "id": 1114063
      },
      "writtenOn": "2024-03-28T01:04:48Z",
      "side": 1,
      "message": "Sorry I\u0027m wrong.. I think you mean if the ADB run got stuck and user send Ctrl-C, then it kill the entire function and the upload wont be executed in this case..\n\nWe can trap the Ctrl-C signal to ensure the upload function is still called, but maybe Hadrien\u0027s suggestion to call the upload function before/after the ADB run is simpler",
      "parentUuid": "fcb6d477_765a22c7",
      "revId": "8b37937a5f2a6e626e07abf34eb21d1adf6466d2",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "a14fd136_e2c432b8",
        "filename": "envsetup.sh",
        "patchSetId": 2
      },
      "lineNbr": 1104,
      "author": {
        "id": 1480888
      },
      "writtenOn": "2024-03-28T17:44:57Z",
      "side": 1,
      "message": "I found an existing example from the build that decorates/wraps another command:\n\nhttps://cs.android.com/android/platform/superproject/main/+/main:build/make/envsetup.sh;l\u003d1939;drc\u003d57c47b70559e343102362caa6db496d59368469d\n\nThis seems to be exactly what we want and would allow us to change how we implement the logging.\n\nAnother approach which may be a bit hackier and similar to your original method is to rename the original method and call it:\n\n```\neval \"original_$(declare -f adb)\"\nadb () {\n  ...\n  original_adb\n  ...\n}\n```\n\nSee https://unix.stackexchange.com/questions/29689/how-do-i-redefine-a-bash-function-in-terms-of-old-definition.\n\nI prefer the first approach.",
      "parentUuid": "26e14111_d7c68cb6",
      "revId": "8b37937a5f2a6e626e07abf34eb21d1adf6466d2",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    }
  ]
}