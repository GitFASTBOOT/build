{
  "comments": [
    {
      "key": {
        "uuid": "64591d73_14f7d300",
        "filename": "core/combo/include/arch/windows/AndroidConfig.h",
        "patchSetId": 1
      },
      "lineNbr": 42,
      "author": {
        "id": 1065256
      },
      "writtenOn": "2015-08-20T01:13:09Z",
      "side": 0,
      "message": "Don\u0027t we need these to map stat to 64-bit stat and related? Or do you guys have some other design around 64-bit file sizes/offsets? adb isn\u0027t totally 64-bit size/offset clean (due to file_sync_service.h being 32-bit), but I have read that people are using adb to push \u003e4GB files on Windows.",
      "range": {
        "startLine": 41,
        "startChar": 0,
        "endLine": 42,
        "endChar": 27
      },
      "revId": "b3c585d745918bebb6e4ea72ad60875adf53337e",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "e4aeed64_a8ab418e",
        "filename": "core/combo/include/arch/windows/AndroidConfig.h",
        "patchSetId": 1
      },
      "lineNbr": 42,
      "author": {
        "id": 1003224
      },
      "writtenOn": "2015-08-20T01:30:18Z",
      "side": 0,
      "message": "we don\u0027t need the latter; if we did, code wouldn\u0027t compile now i\u0027ve removed it.\n\nthe former is harder to tell statically, but there are certainly no references to off_t (or off64_t!) in adb.\n\n(from my exploration of the sync code in my WIP patch to speed up sync by using larger packet sizes i can tell you that no one is transferring \u003e 4GiB files on any platform because adb uses \"unsigned\" to represent file sizes.)",
      "parentUuid": "64591d73_14f7d300",
      "range": {
        "startLine": 41,
        "startChar": 0,
        "endLine": 42,
        "endChar": 27
      },
      "revId": "b3c585d745918bebb6e4ea72ad60875adf53337e",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "e4434d7f_473c0b47",
        "filename": "core/combo/include/arch/windows/AndroidConfig.h",
        "patchSetId": 1
      },
      "lineNbr": 42,
      "author": {
        "id": 1065256
      },
      "writtenOn": "2015-08-20T01:57:16Z",
      "side": 0,
      "message": "I think adb uses \u0027stat\u0027 which sys/stat.h maps to a 64-bit api \u0026 structure if _FILE_OFFSET_BITS\u003d\u003d64. I checked and sizeof(((struct stat*)0)-\u003est_size) \u003d\u003d 8 in Windows builds. Some references to st_size just (incorrectly) truncate to 32-bit, but it seems like some may use it correctly (as a param to pm install-create, which might be broken by this change?).\n\nHere\u0027s a user that is adb pull\u0027ing \u003e4GiB files: https://productforums.google.com/d/msg/nexus/stu63KZzXb8/ki8KOh72AnIJ\n\nI think the reason that the code works in practice is because the sync code only uses the size in determining if a file is different, it doesn\u0027t use it for determining how much to read/write.",
      "parentUuid": "e4aeed64_a8ab418e",
      "range": {
        "startLine": 41,
        "startChar": 0,
        "endLine": 42,
        "endChar": 27
      },
      "revId": "b3c585d745918bebb6e4ea72ad60875adf53337e",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "a4fb1585_e8b07efa",
        "filename": "core/combo/include/arch/windows/AndroidConfig.h",
        "patchSetId": 1
      },
      "lineNbr": 42,
      "author": {
        "id": 1003224
      },
      "writtenOn": "2015-08-20T02:40:51Z",
      "side": 0,
      "message": "(checks.) yeah, you\u0027re right. it works because they only use the size to show progress. (as far as i can tell, sync doesn\u0027t even use the size in deciding what to copy.)\n\nokay, i\u0027ll add this to the combo .mk and dream wistfully of the day when all Windows is 64-bit...",
      "parentUuid": "e4434d7f_473c0b47",
      "range": {
        "startLine": 41,
        "startChar": 0,
        "endLine": 42,
        "endChar": 27
      },
      "revId": "b3c585d745918bebb6e4ea72ad60875adf53337e",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "04806112_158a6fa1",
        "filename": "core/combo/include/arch/windows/AndroidConfig.h",
        "patchSetId": 1
      },
      "lineNbr": 42,
      "author": {
        "id": 1065256
      },
      "writtenOn": "2015-08-20T02:48:25Z",
      "side": 0,
      "message": "See copy_local_dir_remote() where it does \"if(size \u003d\u003d ci-\u003esize) {\" to see how sync checks for file size/timestamp differences. Yes, it is wrong for \u003e4GiB because the protocol only returns a 32-bit size.\n\nI found this when trying to get adb to compile with Visual Studio (whose headers don\u0027t support _FILE_OFFSET_BITS and _LARGEFILE_SOURCE) -- it gave a truncation warning about local_build_list() truncating a 64-bit st_size to 32-bits (which is a red herring since the protocol is the real thing that needs to be fixed to begin with).",
      "parentUuid": "a4fb1585_e8b07efa",
      "range": {
        "startLine": 41,
        "startChar": 0,
        "endLine": 42,
        "endChar": 27
      },
      "revId": "b3c585d745918bebb6e4ea72ad60875adf53337e",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    }
  ]
}