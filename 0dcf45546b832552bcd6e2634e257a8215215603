{
  "comments": [
    {
      "key": {
        "uuid": "92778b6d_1c152c81",
        "filename": "core/java_common.mk",
        "patchSetId": 2
      },
      "lineNbr": 269,
      "author": {
        "id": 1060959
      },
      "writtenOn": "2018-05-18T11:11:35Z",
      "side": 1,
      "message": "I think this is always true in this block (either LOCAL_SDK_VERSION is set of LOCAL_PRIVATE_PLATFORM_APIS is true, which makes the \"else\" block dead code.\n\nI find this whole block a bit strange -- do we need to use LOCAL_SDK_LIBRARIES for modules that don\u0027t use the SDK? They could just reference the impl directly",
      "revId": "0dcf45546b832552bcd6e2634e257a8215215603",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "9f4afb71_458c83c5",
        "filename": "core/java_common.mk",
        "patchSetId": 2
      },
      "lineNbr": 269,
      "author": {
        "id": 1187124
      },
      "writtenOn": "2018-05-21T02:01:11Z",
      "side": 1,
      "message": "\u003e I think this is always true in this block (either LOCAL_SDK_VERSION is set of LOCAL_PRIVATE_PLATFORM_APIS is true, which makes the \"else\" block dead code.\n\nI think it is always true only if LOCAL_MODULE_CLASS is APPS. So I think \"else\" block is not dead code.\n\n\u003e I find this whole block a bit strange -- do we need to use LOCAL_SDK_LIBRARIES for modules that don\u0027t use the SDK? They could just reference the impl directly\n\nIn this case, I think that we need to set the LOCAL_NO_STANDARD_LIBRARIES is true and link the impl directly.",
      "parentUuid": "92778b6d_1c152c81",
      "revId": "0dcf45546b832552bcd6e2634e257a8215215603",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "1bb10875_1f88cb39",
        "filename": "core/java_common.mk",
        "patchSetId": 2
      },
      "lineNbr": 269,
      "author": {
        "id": 1060959
      },
      "writtenOn": "2018-05-21T16:55:52Z",
      "side": 1,
      "message": "\u003e \u003e I think this is always true in this block (either LOCAL_SDK_VERSION is set of LOCAL_PRIVATE_PLATFORM_APIS is true, which makes the \"else\" block dead code.\n\u003e \n\u003e I think it is always true only if LOCAL_MODULE_CLASS is APPS. So I think \"else\" block is not dead code.\n\nLOCAL_PRIVATE_PLATFORM_APIS is only relevant for apps, and the only thing it does is to silence an error if you\u0027re building an app and not setting LOCAL_SDK_VERSION.\n\nIn this block, LOCAL_SDK_VERSION is unset, so we are building against the platform\u0027s bootclasspath. This means building against the impl of all the libs, not the stubs. This CL makes sense from that perspective (though it\u0027s still not clear why you\u0027d want to use LOCAL_SDK_LIBRARIES in this case, since you\u0027re not building against the SDK). However I don\u0027t think the \u0027else\u0027 case here makes sense. If you haven\u0027t set LOCAL_SDK_VERSION, you shouldn\u0027t get different behavior depending on whether LOCAL_PRIVATE_PLATFORM_APIS is set - that variable is just something you need to set if you don\u0027t have a LOCAL_SDK_VERSION (to silence the error).\n\n\u003e \n\u003e \u003e I find this whole block a bit strange -- do we need to use LOCAL_SDK_LIBRARIES for modules that don\u0027t use the SDK? They could just reference the impl directly\n\u003e \n\u003e In this case, I think that we need to set the LOCAL_NO_STANDARD_LIBRARIES is true and link the impl directly.",
      "parentUuid": "9f4afb71_458c83c5",
      "revId": "0dcf45546b832552bcd6e2634e257a8215215603",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "317c5f22_4ef483ff",
        "filename": "core/java_common.mk",
        "patchSetId": 2
      },
      "lineNbr": 269,
      "author": {
        "id": 1002751
      },
      "writtenOn": "2018-05-21T17:15:35Z",
      "side": 1,
      "message": "LOCAL_PRIVATE_PLATFORM_APIS is relevant for java libraries, not just apps.\n\nWe shouldn\u0027t force users of the library to know to specify .impl, that should stay as an implementation detail of java_sdk_library.  That may mean they need to use LOCAL_SDK_LIBRARIES so the build system knows to rewrite the dependency to .impl.\n\nIf LOCAL_PRIVATE_PLATFORM_APIS doesn\u0027t make sense with LOCAL_SDK_VERSION then it should be an error.",
      "parentUuid": "1bb10875_1f88cb39",
      "revId": "0dcf45546b832552bcd6e2634e257a8215215603",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "856437fa_10862a5a",
        "filename": "core/java_common.mk",
        "patchSetId": 2
      },
      "lineNbr": 269,
      "author": {
        "id": 1060959
      },
      "writtenOn": "2018-05-21T17:25:42Z",
      "side": 1,
      "message": "\u003e LOCAL_PRIVATE_PLATFORM_APIS is relevant for java libraries, not just apps.\n\u003e \n\u003e We shouldn\u0027t force users of the library to know to specify .impl, that should stay as an implementation detail of java_sdk_library.  That may mean they need to use LOCAL_SDK_LIBRARIES so the build system knows to rewrite the dependency to .impl.\n\nMy point is just that setting it is the same thing as *not* setting LOCAL_SDK_VERSION. Only enforced for apps at the moment, we could do it for non-apps too, but given we have the link-type check enforcement I don\u0027t think it\u0027s worth it.\n\nOverloading it to mean something else for libraries like this CL does currently (especially choosing between system stubs and the impl lib) seems strange to me.\n\n\u003e \n\u003e If LOCAL_PRIVATE_PLATFORM_APIS doesn\u0027t make sense with LOCAL_SDK_VERSION then it should be an error.\n\nYeah, it is an error already.",
      "parentUuid": "317c5f22_4ef483ff",
      "revId": "0dcf45546b832552bcd6e2634e257a8215215603",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "40c84681_b7e4b9fa",
        "filename": "core/java_common.mk",
        "patchSetId": 2
      },
      "lineNbr": 269,
      "author": {
        "id": 1132673
      },
      "writtenOn": "2018-05-22T13:36:58Z",
      "side": 1,
      "message": "Ok, I agree with Anton that the \u0027else\u0027 block should be dead. So when LOCAL_SDK_VERSION is unset, it always links to the impl library.\n\nHowever, in order it to be dead, we have to enforce the LOCAL_SDK_VERSION/LOCAL_PRIVATE_PLATFORM_APIS even to java libraries, not only to apps. For java libraries, we currently DO allow the state which LOCAL_SDK_VERSION and LOCAL_PRIVATE_PLATFORM_APIS are both unset. How to you think?",
      "parentUuid": "856437fa_10862a5a",
      "revId": "0dcf45546b832552bcd6e2634e257a8215215603",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "3d7518b8_46be932d",
        "filename": "core/java_common.mk",
        "patchSetId": 2
      },
      "lineNbr": 269,
      "author": {
        "id": 1060959
      },
      "writtenOn": "2018-05-22T19:44:44Z",
      "side": 1,
      "message": "\u003e However, in order it to be dead, we have to enforce the LOCAL_SDK_VERSION/LOCAL_PRIVATE_PLATFORM_APIS even to java libraries, not only to apps. For java libraries, we currently DO allow the state which LOCAL_SDK_VERSION and LOCAL_PRIVATE_PLATFORM_APIS are both unset. How to you think?\n\nI don\u0027t think this is worth it given we have link-check. I expect most java libraries end up being included in an app sooner or later anyway, so you won\u0027t be able to set LOCAL_SDK_VERSION for the app but not the lib.",
      "parentUuid": "40c84681_b7e4b9fa",
      "revId": "0dcf45546b832552bcd6e2634e257a8215215603",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": true
    }
  ]
}