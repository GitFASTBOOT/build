{
  "comments": [
    {
      "key": {
        "uuid": "44cedaa4_fa98a16e",
        "filename": "tools/makeparallel/README.md",
        "patchSetId": 1
      },
      "lineNbr": 28,
      "author": {
        "id": 1003981
      },
      "writtenOn": "2015-09-09T02:38:53Z",
      "side": 1,
      "message": "Sounds like the number you get isn\u0027t deterministic - it depends on how many tokens remaining in the pipe when makeparallel is running.\nIn what situations you need to pass this number down to ninja?\nI can imagine that if distributed backend (such as goma) is used, we may want to specify a number much bigger than the cpu cores as parallelism. In that case it\u0027s probably better to hard-code the parallelism in the build system, as KATI_REMOTE_NUM_JOBS_FLAG does now.",
      "range": {
        "startLine": 23,
        "startChar": 0,
        "endLine": 28,
        "endChar": 40
      },
      "revId": "45edafa242495cda450cdf964246fc3954189bfe",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "244c8613_6452e0aa",
        "filename": "tools/makeparallel/README.md",
        "patchSetId": 1
      },
      "lineNbr": 28,
      "author": {
        "id": 1002751
      },
      "writtenOn": "2015-09-09T23:50:52Z",
      "side": 1,
      "message": "It\u0027s deterministic as long as the makeparallel rule is the only one running.  For wrapping ninja, the ninja rule depends on all the other rules so it will always be the only one running and always get the same -j value passed to make.\n\nI missed the local_pool implementation in kati, I can change the next patch to pass -j to kati instead of to ninja.  It\u0027s a little unfortunate that the -j value ends up in the build.ninja file, as that means the file needs to be regenerated every time a different -j value is passed.  Maybe for non-goma I should pass it to ninja, and kati should not use local_pool at all?",
      "parentUuid": "44cedaa4_fa98a16e",
      "range": {
        "startLine": 23,
        "startChar": 0,
        "endLine": 28,
        "endChar": 40
      },
      "revId": "45edafa242495cda450cdf964246fc3954189bfe",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "24c9e69c_f5666bb0",
        "filename": "tools/makeparallel/README.md",
        "patchSetId": 1
      },
      "lineNbr": 28,
      "author": {
        "id": 1003981
      },
      "writtenOn": "2015-09-11T01:26:59Z",
      "side": 1,
      "message": "Sounds good to me. Shinichiro?\nthough I still don\u0027t get why we need to pass -j to ninja, which supposedly enables running jobs in parallel by default.",
      "parentUuid": "244c8613_6452e0aa",
      "range": {
        "startLine": 23,
        "startChar": 0,
        "endLine": 28,
        "endChar": 40
      },
      "revId": "45edafa242495cda450cdf964246fc3954189bfe",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "e4c34e74_f8e9c82a",
        "filename": "tools/makeparallel/README.md",
        "patchSetId": 1
      },
      "lineNbr": 28,
      "author": {
        "id": 1041833
      },
      "writtenOn": "2015-09-11T01:28:46Z",
      "side": 1,
      "message": "Because I\u0027d like it to be configurable. Cores + 2 isn\u0027t a good default when running ART tests, for example (yes, even when niced).",
      "parentUuid": "24c9e69c_f5666bb0",
      "range": {
        "startLine": 23,
        "startChar": 0,
        "endLine": 28,
        "endChar": 40
      },
      "revId": "45edafa242495cda450cdf964246fc3954189bfe",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "44fdfae7_85ca282c",
        "filename": "tools/makeparallel/makeparallel.cpp",
        "patchSetId": 1
      },
      "lineNbr": 174,
      "author": {
        "id": 1003981
      },
      "writtenOn": "2015-09-11T01:26:59Z",
      "side": 1,
      "message": "we don\u0027t return the tokens in this function.",
      "range": {
        "startLine": 174,
        "startChar": 11,
        "endLine": 174,
        "endChar": 60
      },
      "revId": "45edafa242495cda450cdf964246fc3954189bfe",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "8478d270_702b3046",
        "filename": "tools/makeparallel/makeparallel.cpp",
        "patchSetId": 1
      },
      "lineNbr": 174,
      "author": {
        "id": 1002751
      },
      "writtenOn": "2015-09-14T21:42:38Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "44fdfae7_85ca282c",
      "range": {
        "startLine": 174,
        "startChar": 11,
        "endLine": 174,
        "endChar": 60
      },
      "revId": "45edafa242495cda450cdf964246fc3954189bfe",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "04c1426c_fa3789c6",
        "filename": "tools/makeparallel/makeparallel.cpp",
        "patchSetId": 1
      },
      "lineNbr": 228,
      "author": {
        "id": 1074628
      },
      "writtenOn": "2015-09-08T19:43:53Z",
      "side": 1,
      "message": "shouldn\u0027t there be an else case here that prints out a warning that we couldn\u0027t find a jobserver, and will run the command with -j1?",
      "revId": "45edafa242495cda450cdf964246fc3954189bfe",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "24c9e69c_b3a2589b",
        "filename": "tools/makeparallel/makeparallel.cpp",
        "patchSetId": 1
      },
      "lineNbr": 228,
      "author": {
        "id": 1002751
      },
      "writtenOn": "2015-09-08T19:48:29Z",
      "side": 1,
      "message": "If GetJobserver returns false then there was no --jobserver in MAKEFLAGS, which implies the top level make was run with -j1 or no -j argument.  Tokens is initialized to zero, so this falls through and passes -j1 to the wrapped command.",
      "parentUuid": "04c1426c_fa3789c6",
      "revId": "45edafa242495cda450cdf964246fc3954189bfe",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    }
  ]
}