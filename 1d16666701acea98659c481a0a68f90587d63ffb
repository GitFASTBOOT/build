{
  "comments": [
    {
      "key": {
        "uuid": "4e39d5af_c5386b97",
        "filename": "/COMMIT_MSG",
        "patchSetId": 2
      },
      "lineNbr": 18,
      "author": {
        "id": 1056365
      },
      "writtenOn": "2019-10-09T00:00:26Z",
      "side": 1,
      "message": "Could you add a line that references bug 130351427?\n\nBug: 130351427",
      "revId": "1d16666701acea98659c481a0a68f90587d63ffb",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "ff6d77fe_8ea6bee1",
        "filename": "core/Makefile",
        "patchSetId": 2
      },
      "lineNbr": 3142,
      "author": {
        "id": 1056365
      },
      "writtenOn": "2019-10-09T00:00:26Z",
      "side": 1,
      "message": "Not \"must be signed\", but \"must be chained\". Something like\n\n# When building a standalone recovery image for non-A/B devices, recovery image must be configured\n# as a chained partition. See the link below for details.",
      "range": {
        "startLine": 3142,
        "startChar": 0,
        "endLine": 3142,
        "endChar": 51
      },
      "revId": "1d16666701acea98659c481a0a68f90587d63ffb",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "0833034a_e8474759",
        "filename": "core/Makefile",
        "patchSetId": 2
      },
      "lineNbr": 3142,
      "author": {
        "id": 1080813
      },
      "writtenOn": "2019-10-09T16:55:40Z",
      "side": 1,
      "message": "\u003e recovery image must be configured as a chained partition. \n\nBut at L3220 below, we\u0027ll skip configured recovery as a chain partition when building vbmeta.img.\n\nBefore AVB_SLOT_VERIFY_FLAGS_NO_VBMETA_PARTITION, chained partition means self-signed.\nBut after AVB_SLOT_VERIFY_FLAGS_NO_VBMETA_PARTITION is introduced, recovery partition needs self-signed without being chained into vbmeta.img.\n\nHow about:\n# When building a standalone recovery image for non-A/B devices, recovery image must be \n# self-signed to be verified independently, and cannot be chained into vbmeta.img. \n# See the link below for details.",
      "parentUuid": "ff6d77fe_8ea6bee1",
      "range": {
        "startLine": 3142,
        "startChar": 0,
        "endLine": 3142,
        "endChar": 51
      },
      "revId": "1d16666701acea98659c481a0a68f90587d63ffb",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "1e817669_adca7611",
        "filename": "core/Makefile",
        "patchSetId": 2
      },
      "lineNbr": 3142,
      "author": {
        "id": 1056365
      },
      "writtenOn": "2019-10-09T18:36:44Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "0833034a_e8474759",
      "range": {
        "startLine": 3142,
        "startChar": 0,
        "endLine": 3142,
        "endChar": 51
      },
      "revId": "1d16666701acea98659c481a0a68f90587d63ffb",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "4fbe1097_c5f1b76a",
        "filename": "core/Makefile",
        "patchSetId": 2
      },
      "lineNbr": 3145,
      "author": {
        "id": 1056365
      },
      "writtenOn": "2019-10-09T00:00:26Z",
      "side": 1,
      "message": "nit: wrap the line, and replace `, refer to` with `. See`.\n\n$(if $(BOARD_AVB_RECOVERY_KEY_PATH),,\\\n    $(error BOARD_AVB_RECOVERY_KEY_PATH must be defined for non-A/B devices. \\\n            See https://...))",
      "range": {
        "startLine": 3145,
        "startChar": 0,
        "endLine": 3145,
        "endChar": 216
      },
      "revId": "1d16666701acea98659c481a0a68f90587d63ffb",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "4f15cb4b_82ee79a4",
        "filename": "core/Makefile",
        "patchSetId": 2
      },
      "lineNbr": 3145,
      "author": {
        "id": 1080813
      },
      "writtenOn": "2019-10-09T16:55:40Z",
      "side": 1,
      "message": "Should we fallback to $(BOARD_AVB_KEY_PATH) if BOARD_AVB_RECOVERY_KEY_PATH is not set?\n\ne.g.,\nifdef BOARD_AVB_RECOVERY_KEY_PATH\n$(if $(BOARD_AVB_RECOVERY_ALGORITHM),,$(error BOARD_AVB_RECOVERY_ALGORITHM is not defined))\nelse\n# If key path isn\u0027t specified, use the same key as BOARD_AVB_KEY_PATH.\nBOARD_AVB_RECOVERY_KEY_PATH :\u003d $(BOARD_AVB_KEY_PATH)\nBOARD_AVB_RECOVERY_ALGORITHM :\u003d $(BOARD_AVB_ALGORITHM)\nendif\n\nBut the downside is that less people will be aware of this change, that recovery.img should be self-signed.\n\nNote that cuttlefish (aosp_cf_*) is non-A/B, so at least we have to specify BOARD_AVB_RECOVERY_KEY_PATH under \ndevice/google/cuttlefish/shared/BoardConfig.mk, if we want to force a build break.\n\nCuttlefish is the virtual device that heavily used in pre-submit tests.",
      "parentUuid": "4fbe1097_c5f1b76a",
      "range": {
        "startLine": 3145,
        "startChar": 0,
        "endLine": 3145,
        "endChar": 216
      },
      "revId": "1d16666701acea98659c481a0a68f90587d63ffb",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "7b725807_b6bffe4e",
        "filename": "core/Makefile",
        "patchSetId": 2
      },
      "lineNbr": 3145,
      "author": {
        "id": 1056365
      },
      "writtenOn": "2019-10-09T17:06:10Z",
      "side": 1,
      "message": "My concern over falling back to BOARD_AVB_KEY_PATH is we still need to explicitly set BOARD_AVB_RECOVERY_ROLLBACK_INDEX_LOCATION, otherwise it would fail with a general error (... is not defined). So it seems better to fail on BOARD_AVB_RECOVERY_KEY_PATH instead, so that we can provide the link to booting-into-recovery.\n\nRe: cuttlefish\nGood catch. I\u0027ll update this CL, along with a change to cuttlefish.",
      "parentUuid": "4f15cb4b_82ee79a4",
      "range": {
        "startLine": 3145,
        "startChar": 0,
        "endLine": 3145,
        "endChar": 216
      },
      "revId": "1d16666701acea98659c481a0a68f90587d63ffb",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "19540fd9_7f55347b",
        "filename": "core/Makefile",
        "patchSetId": 2
      },
      "lineNbr": 3145,
      "author": {
        "id": 1056365
      },
      "writtenOn": "2019-10-09T18:36:44Z",
      "side": 1,
      "message": "Turns out cuttlefish currently doesn\u0027t use AVB:\nhttps://android.googlesource.com/device/google/cuttlefish/+/refs/heads/master/shared/BoardConfig.mk#27",
      "parentUuid": "7b725807_b6bffe4e",
      "range": {
        "startLine": 3145,
        "startChar": 0,
        "endLine": 3145,
        "endChar": 216
      },
      "revId": "1d16666701acea98659c481a0a68f90587d63ffb",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "1137540e_62023c95",
        "filename": "core/Makefile",
        "patchSetId": 2
      },
      "lineNbr": 3145,
      "author": {
        "id": 1080813
      },
      "writtenOn": "2019-10-10T13:40:24Z",
      "side": 1,
      "message": "\u003e  we still need to explicitly set BOARD_AVB_RECOVERY_ROLLBACK_INDEX_LOCATION, otherwise it would fail with a general error (... is not defined). \n\nOK, SGTM. Thanks for checking the CF as well.",
      "parentUuid": "19540fd9_7f55347b",
      "range": {
        "startLine": 3145,
        "startChar": 0,
        "endLine": 3145,
        "endChar": 216
      },
      "revId": "1d16666701acea98659c481a0a68f90587d63ffb",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "4ed17e4a_79698a23",
        "filename": "core/Makefile",
        "patchSetId": 2
      },
      "lineNbr": 3217,
      "author": {
        "id": 1080813
      },
      "writtenOn": "2019-10-09T16:55:40Z",
      "side": 1,
      "message": "Since the operation here is to add chain descriptors (not related to add a Hash descriptor).\n\nHow about:\n\n# recovery partition in non-A/B devices should be verified separately.\n# Skip adding the chain partition descriptor for recovery partition into vbmeta.img.",
      "range": {
        "startLine": 3216,
        "startChar": 0,
        "endLine": 3217,
        "endChar": 39
      },
      "revId": "1d16666701acea98659c481a0a68f90587d63ffb",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "16d67da4_ccd2afe7",
        "filename": "core/Makefile",
        "patchSetId": 2
      },
      "lineNbr": 3217,
      "author": {
        "id": 1056365
      },
      "writtenOn": "2019-10-09T18:36:44Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "4ed17e4a_79698a23",
      "range": {
        "startLine": 3216,
        "startChar": 0,
        "endLine": 3217,
        "endChar": 39
      },
      "revId": "1d16666701acea98659c481a0a68f90587d63ffb",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "8c2e3ff0_86a3ac48",
        "filename": "core/Makefile",
        "patchSetId": 2
      },
      "lineNbr": 3220,
      "author": {
        "id": 1056365
      },
      "writtenOn": "2019-10-09T00:00:26Z",
      "side": 1,
      "message": "Merge into one line (no needs to define separate vars)\n\n$(if $(or $(filter true,$(AB_OTA_UPDATER)),$(filter-out recovery,$(PART_RECOVERY))),\\\n  ...)",
      "range": {
        "startLine": 3218,
        "startChar": 0,
        "endLine": 3220,
        "endChar": 56
      },
      "revId": "1d16666701acea98659c481a0a68f90587d63ffb",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "44dae0cc_7455d4bd",
        "filename": "core/Makefile",
        "patchSetId": 2
      },
      "lineNbr": 3220,
      "author": {
        "id": 1056365
      },
      "writtenOn": "2019-10-09T18:36:44Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "8c2e3ff0_86a3ac48",
      "range": {
        "startLine": 3218,
        "startChar": 0,
        "endLine": 3220,
        "endChar": 56
      },
      "revId": "1d16666701acea98659c481a0a68f90587d63ffb",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "a40b8f1f_45f51c7b",
        "filename": "tools/releasetools/common.py",
        "patchSetId": 2
      },
      "lineNbr": 659,
      "author": {
        "id": 1056365
      },
      "writtenOn": "2019-10-09T00:00:26Z",
      "side": 1,
      "message": "nit: reordering a bit would make it more readable\n\n  if not key_path:\n    return [\"--include_descriptors_from_image\", image]\n\n  # We don\u0027t chain /recovery into vbmeta if it\u0027s a non-A/B device. /recovery\n  # image will be configured on an independent boot chain. See details in     \n  # https://android.googlesource.com/platform/external/avb/+/master/README.md#booting-into-recovery.\n  if OPTIONS.info_dict.get(\"ab_update\") !\u003d \"true\" and partition \u003d\u003d \"recovery\":\n    return []                                                         \n                                                                               \n  # Otherwise set up the partition chain.\n  chained_partition_arg \u003d GetAvbChainedPartitionArg(partition, info_dict)\n  return [\"--chain_partition\", chained_partition_arg]",
      "range": {
        "startLine": 652,
        "startChar": 0,
        "endLine": 659,
        "endChar": 54
      },
      "revId": "1d16666701acea98659c481a0a68f90587d63ffb",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "20871efb_01d4cd62",
        "filename": "tools/releasetools/common.py",
        "patchSetId": 2
      },
      "lineNbr": 659,
      "author": {
        "id": 1056365
      },
      "writtenOn": "2019-10-09T18:36:44Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "a40b8f1f_45f51c7b",
      "range": {
        "startLine": 652,
        "startChar": 0,
        "endLine": 659,
        "endChar": 54
      },
      "revId": "1d16666701acea98659c481a0a68f90587d63ffb",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "0082e873_f6b1c33d",
        "filename": "tools/releasetools/validate_target_files.py",
        "patchSetId": 2
      },
      "lineNbr": 340,
      "author": {
        "id": 1056365
      },
      "writtenOn": "2019-10-09T00:00:26Z",
      "side": 1,
      "message": "nit: single quote (here and below -- don\u0027t mix the two)",
      "range": {
        "startLine": 340,
        "startChar": 25,
        "endLine": 340,
        "endChar": 26
      },
      "revId": "1d16666701acea98659c481a0a68f90587d63ffb",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "59b16e48_e3bef400",
        "filename": "tools/releasetools/validate_target_files.py",
        "patchSetId": 2
      },
      "lineNbr": 340,
      "author": {
        "id": 1056365
      },
      "writtenOn": "2019-10-09T18:36:44Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "0082e873_f6b1c33d",
      "range": {
        "startLine": 340,
        "startChar": 25,
        "endLine": 340,
        "endChar": 26
      },
      "revId": "1d16666701acea98659c481a0a68f90587d63ffb",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "a4e05852_17319e61",
        "filename": "tools/releasetools/validate_target_files.py",
        "patchSetId": 2
      },
      "lineNbr": 353,
      "author": {
        "id": 1056365
      },
      "writtenOn": "2019-10-09T00:00:26Z",
      "side": 1,
      "message": "nit: I would add an early exit instead (to reduce nesting levels)\n\n  # Exclude /recovery for non-A/B devices.\n  if info_dcit.get(\u0027ab_update\u0027) !\u003d \u0027true\u0027 and partition \u003d\u003d \u0027recovery\u0027:\n    continue\n\n  key_file \u003d ...",
      "range": {
        "startLine": 346,
        "startChar": 8,
        "endLine": 353,
        "endChar": 0
      },
      "revId": "1d16666701acea98659c481a0a68f90587d63ffb",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "1322d77b_80ef63cd",
        "filename": "tools/releasetools/validate_target_files.py",
        "patchSetId": 2
      },
      "lineNbr": 353,
      "author": {
        "id": 1056365
      },
      "writtenOn": "2019-10-09T18:36:44Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "a4e05852_17319e61",
      "range": {
        "startLine": 346,
        "startChar": 8,
        "endLine": 353,
        "endChar": 0
      },
      "revId": "1d16666701acea98659c481a0a68f90587d63ffb",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "b542fc8d_cefb022f",
        "filename": "tools/releasetools/validate_target_files.py",
        "patchSetId": 2
      },
      "lineNbr": 365,
      "author": {
        "id": 1056365
      },
      "writtenOn": "2019-10-09T00:00:26Z",
      "side": 1,
      "message": "Should restrict it to non-A/B:\n\nif (info_dict.get(\u0027ab_update\u0027) !\u003d \u0027true\u0027 and\n    info_dict.get(\u0027no_recovery\u0027) !\u003d \u0027true\u0027):",
      "range": {
        "startLine": 365,
        "startChar": 7,
        "endLine": 365,
        "endChar": 46
      },
      "revId": "1d16666701acea98659c481a0a68f90587d63ffb",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "f40a4ebb_d371a048",
        "filename": "tools/releasetools/validate_target_files.py",
        "patchSetId": 2
      },
      "lineNbr": 365,
      "author": {
        "id": 1056365
      },
      "writtenOn": "2019-10-09T18:36:44Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "b542fc8d_cefb022f",
      "range": {
        "startLine": 365,
        "startChar": 7,
        "endLine": 365,
        "endChar": 46
      },
      "revId": "1d16666701acea98659c481a0a68f90587d63ffb",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "e8b01f28_d190b4e2",
        "filename": "tools/releasetools/validate_target_files.py",
        "patchSetId": 2
      },
      "lineNbr": 369,
      "author": {
        "id": 1056365
      },
      "writtenOn": "2019-10-09T00:00:26Z",
      "side": 1,
      "message": "There shouldn\u0027t be any partition that\u0027s chained into recovery.img. Drop this flag",
      "range": {
        "startLine": 369,
        "startChar": 27,
        "endLine": 369,
        "endChar": 54
      },
      "revId": "1d16666701acea98659c481a0a68f90587d63ffb",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "83bac76d_44bbd651",
        "filename": "tools/releasetools/validate_target_files.py",
        "patchSetId": 2
      },
      "lineNbr": 369,
      "author": {
        "id": 1056365
      },
      "writtenOn": "2019-10-09T18:36:44Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "e8b01f28_d190b4e2",
      "range": {
        "startLine": 369,
        "startChar": 27,
        "endLine": 369,
        "endChar": 54
      },
      "revId": "1d16666701acea98659c481a0a68f90587d63ffb",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    }
  ]
}