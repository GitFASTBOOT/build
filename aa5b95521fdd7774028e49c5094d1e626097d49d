{
  "comments": [
    {
      "key": {
        "uuid": "656c45e7_e81fc9ec",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1132673
      },
      "writtenOn": "2020-09-24T05:00:01Z",
      "side": 1,
      "message": "Could you provide more information for this? (e.g. a bug or something)\n\nWithout knowing any context, this doesn\u0027t seem right because VNDK-SP is for Same-process HALs and Codec2 is NOT a same-process HAL.",
      "revId": "aa5b95521fdd7774028e49c5094d1e626097d49d",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "7dba8930_f347cb38",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1120612
      },
      "writtenOn": "2020-09-24T05:17:57Z",
      "side": 1,
      "message": "Hi Jiyong,\n\nThe library libdmabufheap is going to be needed to build the shared library libcodec2_vndk(https://android.googlesource.com/platform/frameworks/av/+/master/media/codec2/vndk/Android.bp#16) Here is the bug number b/168333162.\nIn order to get it to build, we were following the example of libion(also marked VNDK-SP) which this library is supposed to deprecate/replace eventually. Would marking the library as double_loadable:true be more appropriate? Thank you!\n\nRegards,\nHridya",
      "parentUuid": "656c45e7_e81fc9ec",
      "revId": "aa5b95521fdd7774028e49c5094d1e626097d49d",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "3e39f871_b275e5f7",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1132673
      },
      "writtenOn": "2020-09-24T05:22:10Z",
      "side": 1,
      "message": "Thanks.\n\nWas \"support_system_process: true,\" in the other CL necessary? What happens when you drop it (while keeping vndk.enabled as true)?\n\nlibion is a little bit different because it\u0027s meant to be used by GPU devices which are SP-HALs. Codec2 isn\u0027t an SP-HAL.",
      "parentUuid": "7dba8930_f347cb38",
      "revId": "aa5b95521fdd7774028e49c5094d1e626097d49d",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "65084eae_1dd7a555",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1010110
      },
      "writtenOn": "2020-09-26T06:11:12Z",
      "side": 1,
      "message": "If we drop \"support_system_process:true\" we see:\nerror: frameworks/av/media/codec2/vndk/Android.bp:16:1: module \"libcodec2_vndk\" variant \"android_vendor.S_arm_armv8-a_cortex-a73_shared\": links a library \"libdmabufheap\" which is not LL-NDK, VNDK-SP, or explicitly marked as \u0027double_loadable:true\u0027. (dependency: libcodec2_vndk -\u003e libdmabufheap)\n06:07:38 soong bootstrap failed with: exit status 1\n\nIs double_loadable:true a better fix then?\n\nAlso, its likely that DMABUF Heaps will be used by GPU devices as a replacement for ION in the future. So we may see grallocs making use of  libdmabufheap soon.",
      "parentUuid": "3e39f871_b275e5f7",
      "revId": "aa5b95521fdd7774028e49c5094d1e626097d49d",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "48a0ebbb_952010b3",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1120458
      },
      "writtenOn": "2020-09-28T21:08:58Z",
      "side": 1,
      "message": "Yeah, much better to load it as double_loadable. This acknowledges that it may have multiple copies of itself loaded in the same process (so, for instance, it shouldn\u0027t naively take control of a process-wide lock), but it would avoid exposing it in this API surface. If you expose it in the VNDK, it\u0027s a strong signal to vendors that they can and should use it, and also this being the VNDK-SP, it means that it can be used by in-process HALs. Of course, if these things are needed, vndk-sp makes sense, but I definitely think double_loadable seems to make sense at first glance.",
      "parentUuid": "65084eae_1dd7a555",
      "revId": "aa5b95521fdd7774028e49c5094d1e626097d49d",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "0a84acdc_b1c9097f",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1132673
      },
      "writtenOn": "2020-09-29T00:32:37Z",
      "side": 1,
      "message": "(Sorry that I was late here) +1 to what Steven said. double_loadable: true is not ideal, but is definitely better than support_system_process: true. \n\nThe reason that it has to be \u0027double_loadable: true\u0027 is simply because libcodec2_vndk is marked as such. I see that there\u0027s bugs (b/147147883, b/147147992) for that. When the team can drop double_loadable from libcodec2_vndk, we could drop the same from this lib. So, adding a TODO comment referencing one of the bugs would be good.",
      "parentUuid": "48a0ebbb_952010b3",
      "revId": "aa5b95521fdd7774028e49c5094d1e626097d49d",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": true
    }
  ]
}