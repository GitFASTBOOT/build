{
  "comments": [
    {
      "unresolved": true,
      "key": {
        "uuid": "fbcf7b12_dfbc2158",
        "filename": "/COMMIT_MSG",
        "patchSetId": 1
      },
      "lineNbr": 9,
      "author": {
        "id": 1132673
      },
      "writtenOn": "2021-11-29T12:38:42Z",
      "side": 1,
      "message": "I wonder why ART relies on the system property for this.\n\nI see that /system/bin/dex2oat is a symlink to /apex/com.android.art/bin/dex2oat64 on builds where 64-bit is the primary arch (including 64-bit-only builds). The symlink of course points to the 32-bit variant on 32-bit builds. So, if ART used /system/bin/dex2oat, then we wouldn\u0027t need the system property and the selection logic [1] as well.\n\n[1] https://cs.android.com/android/platform/superproject/+/master:frameworks/native/cmds/installd/dexopt.cpp;drc\u003d54481db5d5d3b36761c5ae453d1905ba16823353;l\u003d1946",
      "range": {
        "startLine": 9,
        "startChar": 0,
        "endLine": 9,
        "endChar": 28
      },
      "revId": "1917e4e047641c8166b77e898568429a773ec364",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "9a471917_07d21839",
        "filename": "/COMMIT_MSG",
        "patchSetId": 1
      },
      "lineNbr": 9,
      "author": {
        "id": 1038443
      },
      "writtenOn": "2021-11-29T14:01:02Z",
      "side": 1,
      "message": "This won\u0027t work if we want to use debug variant of dex2oat (eg  kDex2oatDebug64Path). We could inspect the symlink to infer, looks like the original author didn\u0027t want / consider it.\n\nOne other benefit of a sysprop is that we can do A/B experiment and disable/enable if there\u0027s any issue. Maybe that\u0027s something the original author had in mind.",
      "parentUuid": "fbcf7b12_dfbc2158",
      "range": {
        "startLine": 9,
        "startChar": 0,
        "endLine": 9,
        "endChar": 28
      },
      "revId": "1917e4e047641c8166b77e898568429a773ec364",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "262cfdb9_ba24fb7e",
        "filename": "/COMMIT_MSG",
        "patchSetId": 1
      },
      "lineNbr": 9,
      "author": {
        "id": 1581772
      },
      "writtenOn": "2021-11-29T14:53:27Z",
      "side": 1,
      "message": "To be honest I didn\u0027t consider other alternatives like Jiyong\u0027s proposal, I simply took the quickest route with the existing mechanisms (i.e. the dalvik.vm.dex2oat64.enabled property). It should be possible to modify dexopt.cpp to default to the symlinks if we also create a /system/bin/dex2oatd symlink for the debug version, while still supporting the property (when devices want to override the selected variant, which a number of them already do [1]). That said that\u0027s quite a bit more work, not sure if it\u0027s worth it.\n\n[1] https://cs.android.com/search?q\u003ddalvik.vm.dex2oat64.enabled%20path:device%2F\u0026sq\u003d",
      "parentUuid": "9a471917_07d21839",
      "range": {
        "startLine": 9,
        "startChar": 0,
        "endLine": 9,
        "endChar": 28
      },
      "revId": "1917e4e047641c8166b77e898568429a773ec364",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    }
  ]
}