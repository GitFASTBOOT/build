{
  "comments": [
    {
      "key": {
        "uuid": "a1cf3c0f_d2dbd030",
        "filename": "core/Makefile",
        "patchSetId": 11
      },
      "lineNbr": 4443,
      "author": {
        "id": 1056365
      },
      "writtenOn": "2019-04-08T23:18:17Z",
      "side": 1,
      "message": "I suspect there\u0027s an issue for incremental builds due to the no-deps rule here. INSTALLED_SUPERIMAGE_NODEP_TARGET may not be re-generated, even if there\u0027s a new INSTALLED_SYSTEMIMAGE_TARGET.\n\nIt feels like we need to change the rules with superimage (...again):\n- `m superimage` builds $(PRODUCT_OUT)/super.img by depending on and using the images under $(PRODUCT_OUT). But it should not be triggered with `m` nor `m dist`.\n- `m superimage-nodeps` builds the same, but without checking dependency (or could be dropped given the updated `m superimage`).\n- `m dist` builds the super.img into intermediate dir, which will be installed as dist_files.",
      "range": {
        "startLine": 4443,
        "startChar": 65,
        "endLine": 4443,
        "endChar": 66
      },
      "revId": "05e0b87c077b41a4e60f4bda4ec06aad2e5df37e",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "d5171af7_3e646201",
        "filename": "target/board/BoardConfigEmuCommon.mk",
        "patchSetId": 11
      },
      "lineNbr": 26,
      "author": {
        "id": 1121838
      },
      "writtenOn": "2019-04-08T22:31:03Z",
      "side": 1,
      "message": "nit: just group_emulator / group_emu is good enough",
      "range": {
        "startLine": 26,
        "startChar": 32,
        "endLine": 26,
        "endChar": 59
      },
      "revId": "05e0b87c077b41a4e60f4bda4ec06aad2e5df37e",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "7c411e11_f9a34c70",
        "filename": "target/board/BoardConfigEmuCommon.mk",
        "patchSetId": 11
      },
      "lineNbr": 26,
      "author": {
        "id": 1046320
      },
      "writtenOn": "2019-04-08T22:35:51Z",
      "side": 1,
      "message": "Ack",
      "parentUuid": "d5171af7_3e646201",
      "range": {
        "startLine": 26,
        "startChar": 32,
        "endLine": 26,
        "endChar": 59
      },
      "revId": "05e0b87c077b41a4e60f4bda4ec06aad2e5df37e",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "f8cf445d_4a048db0",
        "filename": "target/board/BoardConfigEmuCommon.mk",
        "patchSetId": 11
      },
      "lineNbr": 31,
      "author": {
        "id": 1121838
      },
      "writtenOn": "2019-04-08T22:31:03Z",
      "side": 1,
      "message": "Can you explain why do you need reserved size?",
      "range": {
        "startLine": 31,
        "startChar": 45,
        "endLine": 31,
        "endChar": 53
      },
      "revId": "05e0b87c077b41a4e60f4bda4ec06aad2e5df37e",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "90805d54_bac3a015",
        "filename": "target/board/BoardConfigEmuCommon.mk",
        "patchSetId": 11
      },
      "lineNbr": 31,
      "author": {
        "id": 1046320
      },
      "writtenOn": "2019-04-08T22:35:51Z",
      "side": 1,
      "message": "for framework developers who want to do adb sync .\nIIUC, adb sync will fail if there is enough space available ?",
      "parentUuid": "f8cf445d_4a048db0",
      "range": {
        "startLine": 31,
        "startChar": 45,
        "endLine": 31,
        "endChar": 53
      },
      "revId": "05e0b87c077b41a4e60f4bda4ec06aad2e5df37e",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "2cdd4cfa_68ee6711",
        "filename": "target/board/BoardConfigEmuCommon.mk",
        "patchSetId": 11
      },
      "lineNbr": 31,
      "author": {
        "id": 1046320
      },
      "writtenOn": "2019-04-08T22:36:25Z",
      "side": 1,
      "message": "typo: not enough",
      "parentUuid": "90805d54_bac3a015",
      "range": {
        "startLine": 31,
        "startChar": 45,
        "endLine": 31,
        "endChar": 53
      },
      "revId": "05e0b87c077b41a4e60f4bda4ec06aad2e5df37e",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "e2ea1c8e_50e43f8a",
        "filename": "target/board/BoardConfigEmuCommon.mk",
        "patchSetId": 11
      },
      "lineNbr": 31,
      "author": {
        "id": 1121838
      },
      "writtenOn": "2019-04-08T22:37:59Z",
      "side": 1,
      "message": "You can keep this for now, but the proper solution is to enable overlayfs (I think). Also, I don\u0027t think 50MB\u0027s of free space is going to help a lot (frameworks.jar is much larger than this).\n\nI am not sure how hard it is to enable overlayfs on emulator though...",
      "parentUuid": "90805d54_bac3a015",
      "range": {
        "startLine": 31,
        "startChar": 45,
        "endLine": 31,
        "endChar": 53
      },
      "revId": "05e0b87c077b41a4e60f4bda4ec06aad2e5df37e",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "902f6546_b5482345",
        "filename": "target/board/BoardConfigEmuCommon.mk",
        "patchSetId": 11
      },
      "lineNbr": 31,
      "author": {
        "id": 1046320
      },
      "writtenOn": "2019-04-08T22:40:10Z",
      "side": 1,
      "message": "thanks Yifan;\nwill follow up on the overlayfs after this.",
      "parentUuid": "e2ea1c8e_50e43f8a",
      "range": {
        "startLine": 31,
        "startChar": 45,
        "endLine": 31,
        "endChar": 53
      },
      "revId": "05e0b87c077b41a4e60f4bda4ec06aad2e5df37e",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "3d499b4d_02e01b33",
        "filename": "target/board/BoardConfigEmuCommon.mk",
        "patchSetId": 11
      },
      "lineNbr": 31,
      "author": {
        "id": 1032276
      },
      "writtenOn": "2019-04-09T15:05:36Z",
      "side": 1,
      "message": "Conditions for overlayfs (you are probably already there and you do not know it?)\n- kernel is merged down from android common (and thus has the overlayfs patches)\n- CONFIG_OVERLAY_FS\u003dy\n- Access to either /system/bin/make_f2fs or /system/bin/mke2fs (these are always there, but are at the option of the Board Configuration so must be mentioned)\n- first_stage_init (on some system configes can be skipped, so must be mentioned).\n- Storage that overlayfs can steal(tm) as backing, one of:\n 1) super partition (any) with lots of free space (\u003e2GB) after all other partitions accounted for.\n 2) on A/B system_\u003cother\u003e partition just sitting there ready to capture.\n 3) on non A/B systems, a /cache partition with free space (you might wish to make it larger, 2GB+)\n\nPartitions that are candidate for overlayfs:\n1) readonly filesystems squashfs, erofs or ext4 deduped (last is kind of a requirement for dynamic partitions, missing here(!))\n2) right sized partitions (a requirement for dynamic partitions, circumventing here(!)) with less than 1% free space.",
      "parentUuid": "902f6546_b5482345",
      "range": {
        "startLine": 31,
        "startChar": 45,
        "endLine": 31,
        "endChar": 53
      },
      "revId": "05e0b87c077b41a4e60f4bda4ec06aad2e5df37e",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "39562606_34448da0",
        "filename": "target/board/BoardConfigEmuCommon.mk",
        "patchSetId": 11
      },
      "lineNbr": 31,
      "author": {
        "id": 1046320
      },
      "writtenOn": "2019-04-10T18:26:40Z",
      "side": 1,
      "message": "thanks Mark, Yifan:\nI removed the _RESERVED_SIZE \nour kernel just updated with CONFIG_OVERLAY_FS\u003dy",
      "parentUuid": "3d499b4d_02e01b33",
      "range": {
        "startLine": 31,
        "startChar": 45,
        "endLine": 31,
        "endChar": 53
      },
      "revId": "05e0b87c077b41a4e60f4bda4ec06aad2e5df37e",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "34bd6212_f75e1c64",
        "filename": "target/board/BoardConfigEmuCommon.mk",
        "patchSetId": 11
      },
      "lineNbr": 31,
      "author": {
        "id": 1046320
      },
      "writtenOn": "2019-04-10T21:08:35Z",
      "side": 1,
      "message": "Mark: \nI added back ext4 dedup to true; also checked sytem/bin/mke2fs exists, enabled\nCONFIG_OVERLAY_FS\u003dy in kernel, \nhowever, adb remount fails\n\nW failed to remount partition dev:/dev/block/dm-0 mnt:/: Read-only file system\n\nI am not seeing any debug/error information on the kernel log regarding overlayfs.\ndo I have to manually enable some debug flag somewhere so I know what has gone wrong ?\n\nthanks",
      "parentUuid": "39562606_34448da0",
      "range": {
        "startLine": 31,
        "startChar": 45,
        "endLine": 31,
        "endChar": 53
      },
      "revId": "05e0b87c077b41a4e60f4bda4ec06aad2e5df37e",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "1605f625_bafd678c",
        "filename": "target/board/BoardConfigEmuCommon.mk",
        "patchSetId": 11
      },
      "lineNbr": 31,
      "author": {
        "id": 1032276
      },
      "writtenOn": "2019-04-11T19:59:42Z",
      "side": 1,
      "message": "\u0027remount -R\u0027 should(?) reboot and un-dedupe the filesystem. However the issue is that overlayfs is not being triggered on the filesystem. I expect that b/130327601 is to investigate that.\n\nNo debug flag(s)",
      "parentUuid": "34bd6212_f75e1c64",
      "range": {
        "startLine": 31,
        "startChar": 45,
        "endLine": 31,
        "endChar": 53
      },
      "revId": "05e0b87c077b41a4e60f4bda4ec06aad2e5df37e",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "a4c2c3de_39389b4a",
        "filename": "target/board/BoardConfigGsiCommon.mk",
        "patchSetId": 11
      },
      "lineNbr": 46,
      "author": {
        "id": 1128729
      },
      "writtenOn": "2019-04-10T03:18:29Z",
      "side": 1,
      "message": "Why does not eng build need this?",
      "range": {
        "startLine": 46,
        "startChar": 17,
        "endLine": 46,
        "endChar": 20
      },
      "revId": "05e0b87c077b41a4e60f4bda4ec06aad2e5df37e",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "9a0df30d_1ac47766",
        "filename": "target/board/BoardConfigGsiCommon.mk",
        "patchSetId": 11
      },
      "lineNbr": 46,
      "author": {
        "id": 1080813
      },
      "writtenOn": "2019-04-10T08:02:10Z",
      "side": 1,
      "message": "Oh, prior to AVB (vboot 1.0), eng build doesn\u0027t enable verified boot.\n\nHowever, for AVB (a.k.a. vboot 2.0), we enable verified boot regardless of build image variants.\nSo we probably still need the flag 2 for eng build here.",
      "parentUuid": "a4c2c3de_39389b4a",
      "range": {
        "startLine": 46,
        "startChar": 17,
        "endLine": 46,
        "endChar": 20
      },
      "revId": "05e0b87c077b41a4e60f4bda4ec06aad2e5df37e",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "1d9c6dac_9beff14b",
        "filename": "target/board/BoardConfigGsiCommon.mk",
        "patchSetId": 11
      },
      "lineNbr": 46,
      "author": {
        "id": 1046320
      },
      "writtenOn": "2019-04-11T04:57:39Z",
      "side": 1,
      "message": "Ack",
      "parentUuid": "9a0df30d_1ac47766",
      "range": {
        "startLine": 46,
        "startChar": 17,
        "endLine": 46,
        "endChar": 20
      },
      "revId": "05e0b87c077b41a4e60f4bda4ec06aad2e5df37e",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    }
  ]
}