{
  "comments": [
    {
      "unresolved": true,
      "key": {
        "uuid": "76fb8315_61fa5527",
        "filename": "core/product-graph.mk",
        "patchSetId": 1
      },
      "lineNbr": 44,
      "author": {
        "id": 1535516
      },
      "writtenOn": "2022-03-16T19:14:32Z",
      "side": 1,
      "message": "I don\u0027t like the fact that we have two different backing data sources for the product graph, the INHERITS_FROM variables and the INHERIT_GRAPH variable.\n\nIf I understand this correctly, the point of this CL is to simplify the Starlark graph generation? So the code will go from:\n\n```\nfor config in configs:\n    if len(configs[config][2]) \u003e 0:\n        globals[\"PRODUCTS.\"+config+\".mk.INHERITS_FROM\"] \u003d sorted([x + \".mk\" for x in configs[config][2]])\n```\n\nto:\n\n```\nfor config in configs:\n    for inherited in configs[config][2]:\n        globals[\"INHERIT_GRAPH\"] +\u003d config + \".mk:\" + inherited + \".mk\"\n```\n\nIs that really any simpler? It\u0027s the same number of lines, and theres extra complexity here in order to support the two different formats,",
      "revId": "2f28991905b0960bbcebede6bafb3ad588cc630b",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "c5745968_49858b0d",
        "filename": "core/product-graph.mk",
        "patchSetId": 1
      },
      "lineNbr": 44,
      "author": {
        "id": 1344584
      },
      "writtenOn": "2022-03-17T02:29:55Z",
      "side": 1,
      "message": "First, I believe the only change needed is to add a single line in _product_configuration in product_config.rbc. I see way more stuff changed in the same file in aosp/2002321\nSecondly, it adds only a single line to the output instead of at least dozen.",
      "parentUuid": "76fb8315_61fa5527",
      "revId": "2f28991905b0960bbcebede6bafb3ad588cc630b",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "12607b65_6a99fbc1",
        "filename": "core/product-graph.mk",
        "patchSetId": 1
      },
      "lineNbr": 44,
      "author": {
        "id": 1535516
      },
      "writtenOn": "2022-03-17T17:56:10Z",
      "side": 1,
      "message": "Note that we need the PRODUCTS.\u003cmkfile\u003e.\u003cvariable\u003e variables for artifact path requirements as well. Artifact path requirements need to know the state of the variables after importing intermediate products, not just their state at the end of all of product config. So doing this won\u0027t allow us to remove those variables.\n\nEven when we have the PRODUCTS.\u003cmkfile\u003e.\u003cvariable\u003e, it doesn\u0027t add any lines to the output, because we removed the regular unqualified versions of the variables. Even if it did add output, I don\u0027t see why that\u0027s an issue as the output is not really human-readable anyways.\n\nI don\u0027t really see any upsides to this CL, but there are a lot of downsides (duplicated graph generation code, removing support for ANDROID_PRODUCT_GRAPH, and making it harder to support artifact path requirements)",
      "parentUuid": "c5745968_49858b0d",
      "revId": "2f28991905b0960bbcebede6bafb3ad588cc630b",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "7f5d94e6_37d95c7f",
        "filename": "core/product-graph.mk",
        "patchSetId": 1
      },
      "lineNbr": 50,
      "author": {
        "id": 1535516
      },
      "writtenOn": "2022-03-17T17:56:10Z",
      "side": 1,
      "message": "Isn\u0027t this duplicated now with the rule below to make $(products_graph)?",
      "revId": "2f28991905b0960bbcebede6bafb3ad588cc630b",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "b10c767f_321aba17",
        "filename": "core/product-graph.mk",
        "patchSetId": 1
      },
      "lineNbr": 55,
      "author": {
        "id": 1535516
      },
      "writtenOn": "2022-03-16T19:14:32Z",
      "side": 1,
      "message": "ANDROID_PRODUCT_GRAPH is something we can easily support in Starlark with the old system. Why are we refactoring into less functionality?",
      "revId": "2f28991905b0960bbcebede6bafb3ad588cc630b",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "ba14c69b_905a9c5a",
        "filename": "core/product-graph.mk",
        "patchSetId": 1
      },
      "lineNbr": 55,
      "author": {
        "id": 1344584
      },
      "writtenOn": "2022-03-17T02:29:55Z",
      "side": 1,
      "message": "I don\u0027t think it\u0027s very important, the results are dubious for the modules inherited conditionally.",
      "parentUuid": "b10c767f_321aba17",
      "revId": "2f28991905b0960bbcebede6bafb3ad588cc630b",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "e1421a7f_94eb3610",
        "filename": "tools/generate-inheritance.sh",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1535516
      },
      "writtenOn": "2022-03-16T19:14:32Z",
      "side": 1,
      "message": "While this is technically subjective, I believe python is the better choice for these scripts than bash. Pretty much all of build/make/tools is already written in python. Python is also an approved google language and \"the 3rd most used language ecosystem at google\" (go/programming-language-policy).\n\nIf you really don\u0027t like python, java/go would probably be better choices still for number of people who can read/write it.",
      "revId": "2f28991905b0960bbcebede6bafb3ad588cc630b",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "75acab82_577d28e0",
        "filename": "tools/generate-inheritance.sh",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1344584
      },
      "writtenOn": "2022-03-17T02:29:55Z",
      "side": 1,
      "message": "This script is short, runs immediately, is easy to debug and does not leave unwanted artifacts.",
      "parentUuid": "e1421a7f_94eb3610",
      "revId": "2f28991905b0960bbcebede6bafb3ad588cc630b",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    }
  ]
}