{
  "comments": [
    {
      "key": {
        "uuid": "79b7df4c_5370f6ab",
        "filename": "/COMMIT_MSG",
        "patchSetId": 3
      },
      "lineNbr": 14,
      "author": {
        "id": 1003981
      },
      "writtenOn": "2014-04-11T01:32:31Z",
      "side": 1,
      "message": "Something I am not clear: For unbundled apps, we use those flags to determine the abi of the embedded shared libraries; but for apps bundled in the system image,  the libraries are installed separately to /system/lib (in Android.mk we use LOCAL_REQUIRED_MODULES instead of LOCAL_JNI_SHARED_LIBRARIES) - how the apk (or runtime) knows whether to load the 32-bit libs or the 64-bit libs?\nWith LOCAL_REQUIRED_MODULES the dependency will be established only after all the Android.mks are loaded, so this change seems not enough. We need to change how required module names are explained in build/core/main.mk too.\n(The framework team was talking about bundling apks with embedded JNI libraries in system.img and release the libs when the apk is run the first time. That would make things simpler.)",
      "revId": "6dd11104cd4276954a31fa8504b0d755c433c6b8",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "d9544bb3_290e09be",
        "filename": "/COMMIT_MSG",
        "patchSetId": 3
      },
      "lineNbr": 14,
      "author": {
        "id": 1002751
      },
      "writtenOn": "2014-04-11T01:37:49Z",
      "side": 1,
      "message": "I\u0027ve thought about this, but I\u0027m not an expert on the runtime so I\u0027m not sure what the solution is.  I would guess that we should remove LOCAL_REQUIRED_MODULES from apps, and have the build system use LOCAL_JNI_SHARED_LIBRARIES to choose what to install in /system/lib[64], and used the architecture of the package to choose 32-bit or 64-bit library dependencies.  The architecture of the package will also need to end up in the apk somewhere so activitymanager knows which zygote to use to launch the app.",
      "parentUuid": "79b7df4c_5370f6ab",
      "revId": "6dd11104cd4276954a31fa8504b0d755c433c6b8",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "996f3376_fc0ae8ef",
        "filename": "/COMMIT_MSG",
        "patchSetId": 3
      },
      "lineNbr": 14,
      "author": {
        "id": 1003981
      },
      "writtenOn": "2014-04-11T04:29:04Z",
      "side": 1,
      "message": "I would prefer to not have the arch info built into the apk, if there is no other reason. Otherwise we would end up with 2 copies of an apks in the source tree with just the 32-bit v.s. 64-bit difference. (Currently we have only 1 copy of GmsCore.apk checked in that serves arm, x86 and mips. That\u0027s really good.)",
      "parentUuid": "d9544bb3_290e09be",
      "revId": "6dd11104cd4276954a31fa8504b0d755c433c6b8",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "99b2d35a_d40972fa",
        "filename": "core/package.mk",
        "patchSetId": 3
      },
      "lineNbr": 18,
      "author": {
        "id": 1003981
      },
      "writtenOn": "2014-04-11T01:32:31Z",
      "side": 1,
      "message": "This doesn\u0027t work for 32-bit build if \"LOCAL_MULTILIB :\u003d first\".\nWe only want to convert \"first\" to \"none\" if it\u0027s TARGET_2ND_ARCH is set.",
      "revId": "6dd11104cd4276954a31fa8504b0d755c433c6b8",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "b9df977e_a869ffd0",
        "filename": "core/package.mk",
        "patchSetId": 3
      },
      "lineNbr": 18,
      "author": {
        "id": 1002751
      },
      "writtenOn": "2014-04-11T01:37:49Z",
      "side": 1,
      "message": "You\u0027re right, it worked above because TARGET_SUPPORTS_64_BIT_APPS should only be set if TARGET_2ND_ARCH is set, but it needs more logic here.",
      "parentUuid": "99b2d35a_d40972fa",
      "revId": "6dd11104cd4276954a31fa8504b0d755c433c6b8",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "79b7df4c_3315725b",
        "filename": "core/package.mk",
        "patchSetId": 3
      },
      "lineNbr": 19,
      "author": {
        "id": 1003981
      },
      "writtenOn": "2014-04-11T01:32:31Z",
      "side": 1,
      "message": "The default behavior (neither is set) changed here: previously it defaults to 64-bit. From your commit message it seems to be intended.",
      "revId": "6dd11104cd4276954a31fa8504b0d755c433c6b8",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "d9544bb3_a921992f",
        "filename": "core/package.mk",
        "patchSetId": 3
      },
      "lineNbr": 19,
      "author": {
        "id": 1002751
      },
      "writtenOn": "2014-04-11T01:37:49Z",
      "side": 1,
      "message": "Previously it defaulted to 64-bit, but the blacklist was forcing everything back to 32-bit.  This is to maintain the current behavior once the blacklist is removed, at which point individual devices can opt-in to 64-bit apps.  I hope the opting-in is combined into whatever they end up needing to do to install the 64-bit zygote.",
      "parentUuid": "79b7df4c_3315725b",
      "revId": "6dd11104cd4276954a31fa8504b0d755c433c6b8",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "99b2d35a_94b6ca6c",
        "filename": "core/package.mk",
        "patchSetId": 3
      },
      "lineNbr": 19,
      "author": {
        "id": 1003981
      },
      "writtenOn": "2014-04-11T01:47:45Z",
      "side": 1,
      "message": "Ah, I forgot the fact you blacklisted the whole packages/ subtree. But there are apps defined elsewhere, such as in frameworks/base, vendor/unbundled_google/, etc.",
      "parentUuid": "d9544bb3_a921992f",
      "revId": "6dd11104cd4276954a31fa8504b0d755c433c6b8",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "d9544bb3_49602569",
        "filename": "core/package.mk",
        "patchSetId": 3
      },
      "lineNbr": 19,
      "author": {
        "id": 1002751
      },
      "writtenOn": "2014-04-11T01:50:58Z",
      "side": 1,
      "message": "Most of them were blacklisted too, until we started fixing them recently.  That\u0027s why I started this series.",
      "parentUuid": "99b2d35a_94b6ca6c",
      "revId": "6dd11104cd4276954a31fa8504b0d755c433c6b8",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    }
  ]
}