{
  "comments": [
    {
      "key": {
        "uuid": "189d6350_5fb76376",
        "filename": "core/product_config.mk",
        "patchSetId": 3
      },
      "lineNbr": 332,
      "author": {
        "id": 1052644
      },
      "writtenOn": "2019-10-25T17:28:25Z",
      "side": 1,
      "message": "So, this does not seem to workâ€¦ There is no `/system/framework/jacocoagent.jar` file in the generated product in my `cf_x86_phone-userdebug_coverage` build produced by Forrest on PS3 (https://android-build.googleplex.com/builds/forrest/run/L50900000381584108).\n\nI moved the logic back into `target/product/base_system.mk` and `core/envsetup.mk` in PS4.",
      "range": {
        "startLine": 332,
        "startChar": 4,
        "endLine": 332,
        "endChar": 35
      },
      "revId": "068d777a8107500a4a3d12f5b42ebf3bff249c31",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "0298c5ff_d8866b54",
        "filename": "core/product_config.mk",
        "patchSetId": 3
      },
      "lineNbr": 332,
      "author": {
        "id": 1060959
      },
      "writtenOn": "2019-10-28T11:19:54Z",
      "side": 1,
      "message": "try assigning to PRODUCTS.$(INTERNAL_PRODUCT).PRODUCT_PACKAGES instead ?",
      "parentUuid": "189d6350_5fb76376",
      "range": {
        "startLine": 332,
        "startChar": 4,
        "endLine": 332,
        "endChar": 35
      },
      "revId": "068d777a8107500a4a3d12f5b42ebf3bff249c31",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "d996ecb7_37704c77",
        "filename": "core/product_config.mk",
        "patchSetId": 3
      },
      "lineNbr": 332,
      "author": {
        "id": 1060959
      },
      "writtenOn": "2019-10-28T12:16:31Z",
      "side": 1,
      "message": "alternatively rebase on r.android.com/1151462",
      "parentUuid": "0298c5ff_d8866b54",
      "range": {
        "startLine": 332,
        "startChar": 4,
        "endLine": 332,
        "endChar": 35
      },
      "revId": "068d777a8107500a4a3d12f5b42ebf3bff249c31",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "77ade5bf_5371c486",
        "filename": "core/product_config.mk",
        "patchSetId": 3
      },
      "lineNbr": 332,
      "author": {
        "id": 1052644
      },
      "writtenOn": "2019-10-28T13:34:11Z",
      "side": 1,
      "message": "\u003e try assigning to PRODUCTS.$(INTERNAL_PRODUCT).PRODUCT_PACKAGES instead ?\n\nThanks. I tried this in `core/product_config.mk`:\n\n  # Jacoco agent JARS to be built and installed, if any.\n  ifeq ($(EMMA_INSTRUMENT),true)\n    ifneq ($(EMMA_INSTRUMENT_STATIC),true)\n      # For instrumented build, if Jacoco is not being included statically\n      # in instrumented packages then include Jacoco classes into the\n      # bootclasspath.\n      PRODUCTS.$(INTERNAL_PRODUCT).PRODUCT_PACKAGES +\u003d jacocoagent\n      PRODUCTS.$(INTERNAL_PRODUCT).PRODUCT_BOOT_JARS +\u003d jacocoagent\n    endif # EMMA_INSTRUMENT_STATIC\n  endif # EMMA_INSTRUMENT\n\nBut the list of files installed on the system partition seems incorrect:\n  \n  /system/framework/jacocoagent.jar\n  /system/framework/oat/arm/jacocoagent.odex\n  /system/framework/oat/arm/jacocoagent.vdex\n  /system/framework/oat/arm64/jacocoagent.odex\n  /system/framework/oat/arm64/jacocoagent.vdex\n\nI expected this:\n\n  /system/framework/apex-jacocoagent.vdex\n  /system/framework/arm/apex-jacocoagent.art\n  /system/framework/arm/apex-jacocoagent.oat\n  /system/framework/arm/apex-jacocoagent.vdex\n  /system/framework/arm/boot-jacocoagent.art\n  /system/framework/arm/boot-jacocoagent.oat\n  /system/framework/arm/boot-jacocoagent.vdex\n  /system/framework/arm64/apex-jacocoagent.art\n  /system/framework/arm64/apex-jacocoagent.oat\n  /system/framework/arm64/apex-jacocoagent.vdex\n  /system/framework/arm64/boot-jacocoagent.art\n  /system/framework/arm64/boot-jacocoagent.oat\n  /system/framework/arm64/boot-jacocoagent.vdex\n  /system/framework/boot-jacocoagent.vdex\n  /system/framework/jacocoagent.jar",
      "parentUuid": "d996ecb7_37704c77",
      "range": {
        "startLine": 332,
        "startChar": 4,
        "endLine": 332,
        "endChar": 35
      },
      "revId": "068d777a8107500a4a3d12f5b42ebf3bff249c31",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "743057c5_af7af6f3",
        "filename": "core/product_config.mk",
        "patchSetId": 3
      },
      "lineNbr": 332,
      "author": {
        "id": 1060959
      },
      "writtenOn": "2019-10-28T14:01:15Z",
      "side": 1,
      "message": "okay, I think you\u0027re going to have to dig into what\u0027s causing that discrepancy? shouldn\u0027t TARGET_CORE_JARS be involved somehow?",
      "parentUuid": "77ade5bf_5371c486",
      "range": {
        "startLine": 332,
        "startChar": 4,
        "endLine": 332,
        "endChar": 35
      },
      "revId": "068d777a8107500a4a3d12f5b42ebf3bff249c31",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "beb815ea_8e146a23",
        "filename": "core/product_config.mk",
        "patchSetId": 3
      },
      "lineNbr": 332,
      "author": {
        "id": 1052644
      },
      "writtenOn": "2019-10-28T14:14:21Z",
      "side": 1,
      "message": "It could be, but I don\u0027t understand why: we don\u0027 use TARGET_CORE_JARS in PS6, which produces the expected result.",
      "parentUuid": "743057c5_af7af6f3",
      "range": {
        "startLine": 332,
        "startChar": 4,
        "endLine": 332,
        "endChar": 35
      },
      "revId": "068d777a8107500a4a3d12f5b42ebf3bff249c31",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "51348297_ddbc42cf",
        "filename": "core/product_config.mk",
        "patchSetId": 3
      },
      "lineNbr": 334,
      "author": {
        "id": 1060959
      },
      "writtenOn": "2019-10-25T11:41:48Z",
      "side": 1,
      "message": "can we remove the stuff in envsetup.mk now ?",
      "range": {
        "startLine": 327,
        "startChar": 0,
        "endLine": 334,
        "endChar": 5
      },
      "revId": "068d777a8107500a4a3d12f5b42ebf3bff249c31",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "71ce7581_a9cd6dbd",
        "filename": "core/product_config.mk",
        "patchSetId": 3
      },
      "lineNbr": 334,
      "author": {
        "id": 1052644
      },
      "writtenOn": "2019-10-25T12:02:31Z",
      "side": 1,
      "message": "I\u0027ll try; I need to check wether adding `jacocoagent` to `TARGET_CORE_JARS` is still necessary.",
      "parentUuid": "51348297_ddbc42cf",
      "range": {
        "startLine": 327,
        "startChar": 0,
        "endLine": 334,
        "endChar": 5
      },
      "revId": "068d777a8107500a4a3d12f5b42ebf3bff249c31",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "2ecee86e_a683aa92",
        "filename": "core/product_config.mk",
        "patchSetId": 3
      },
      "lineNbr": 334,
      "author": {
        "id": 1052644
      },
      "writtenOn": "2019-10-25T15:23:50Z",
      "side": 1,
      "message": "I think the presence of `jacocoagent` in `TARGET_CORE_JARS` was twofold:\n1. make sure it is installed (by being eventually included in `PRODUCT_PACKAGES`);\n2. make sure it is Dex pre-opted (by being eventually included in `PRODUCT_BOOT_JARS`).\n\nPS3 addresses the first point; I\u0027ll address the second point in my next patch set.",
      "parentUuid": "71ce7581_a9cd6dbd",
      "range": {
        "startLine": 327,
        "startChar": 0,
        "endLine": 334,
        "endChar": 5
      },
      "revId": "068d777a8107500a4a3d12f5b42ebf3bff249c31",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "895eaf21_72c21eca",
        "filename": "core/product_config.mk",
        "patchSetId": 3
      },
      "lineNbr": 334,
      "author": {
        "id": 1052644
      },
      "writtenOn": "2019-10-25T17:28:25Z",
      "side": 1,
      "message": "Done in PS4.",
      "parentUuid": "2ecee86e_a683aa92",
      "range": {
        "startLine": 327,
        "startChar": 0,
        "endLine": 334,
        "endChar": 5
      },
      "revId": "068d777a8107500a4a3d12f5b42ebf3bff249c31",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    }
  ]
}