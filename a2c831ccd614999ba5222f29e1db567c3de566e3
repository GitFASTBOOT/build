{
  "comments": [
    {
      "unresolved": true,
      "key": {
        "uuid": "04b10852_0c61ea04",
        "filename": "/COMMIT_MSG",
        "patchSetId": 2
      },
      "lineNbr": 9,
      "author": {
        "id": 1550939
      },
      "writtenOn": "2021-04-27T14:50:38Z",
      "side": 1,
      "message": "To clarify, if another boot jar from PRODUCT_BOOT_JARS moves to an apex, it won\u0027t be a problem, we\u0027ll have to move it after core-icu4j.jar, right?\n\nHow will we know about it -- will the build break, or will the device fail to boot?",
      "range": {
        "startLine": 9,
        "startChar": 31,
        "endLine": 9,
        "endChar": 58
      },
      "revId": "a2c831ccd614999ba5222f29e1db567c3de566e3",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "6c387844_dd95f370",
        "filename": "/COMMIT_MSG",
        "patchSetId": 2
      },
      "lineNbr": 9,
      "author": {
        "id": 1061164
      },
      "writtenOn": "2021-04-27T15:08:42Z",
      "side": 1,
      "message": "Note that this is not part of an _updatable_ module. All updatable apex jars go into PRODUCT_UPDATABLE_BOOT_JARS (except art).\n\nIn general, there was a request to have following ordering:\n\n1. ART jars\n2. /system jars\n3. /apex jars\n4. /system_ext, etc.\n\nART_APEX_JARS are special cased and live above everything else, given that icu4j was part of ART, I moved it here as well, but happy to put below /system jars just like any other existing apex. In fact maybe we should?\n\nAny other boot jar moving into apex would have to be in the (3) category. At runtime we\u0027ll do the right thing. Nothing exists to check any of this at build time, but with Paul\u0027s work we are also changing how we even define these... with introduction of bootclasspath_fragments and platform_bootclasspath_fragments we could do more at build time probably.",
      "parentUuid": "04b10852_0c61ea04",
      "range": {
        "startLine": 9,
        "startChar": 31,
        "endLine": 9,
        "endChar": 58
      },
      "revId": "a2c831ccd614999ba5222f29e1db567c3de566e3",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "feab2c41_73e23a85",
        "filename": "/COMMIT_MSG",
        "patchSetId": 2
      },
      "lineNbr": 9,
      "author": {
        "id": 1550939
      },
      "writtenOn": "2021-04-27T16:01:55Z",
      "side": 1,
      "message": "My question was, if some system jar from PRODUCT_BOOT_JARS moves to a non-updatable apex, will that be a problem, and if yes, how will it manifest? Maybe we should have a build system check in the makefile to fail if one of the (non-updatable) apex jars in PRODUCT_BOOT_JARS is higher on the list than system jars?\n\nMaybe this was missing from the original ordering request, but it seems that:\n- non-updatable apex jars in PRODUCT_BOOT_JARS should be grouped at the end\n- derive_classpath should have some logic to walk non-updatable apexes before updatable ones\n\nOr else, how will derive_classpath know to insert icu4j before updatable apex jars?\n\n\u003e At runtime we\u0027ll do the right thing.\n\nCan you explain this a bit?",
      "parentUuid": "6c387844_dd95f370",
      "range": {
        "startLine": 9,
        "startChar": 31,
        "endLine": 9,
        "endChar": 58
      },
      "revId": "a2c831ccd614999ba5222f29e1db567c3de566e3",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "e5af0b5f_090d5b21",
        "filename": "/COMMIT_MSG",
        "patchSetId": 2
      },
      "lineNbr": 9,
      "author": {
        "id": 1061164
      },
      "writtenOn": "2021-04-27T16:20:05Z",
      "side": 1,
      "message": "Will we mandate bootclasspath_fragment{} definitions to exist for non-updatable apex? Probably yes, and I believe this is what Paul is going to do at some point. bootclasspath_fragment{} would then generate apex\u0027s classpaths.proto config.\n\nFrom my perspective I\u0027d say we should treat them as any other apex jars, let them have their own config and put them after /system jars in derive_classpath. Once that new apex decides to be updatable -- i.e. the ordering will not be a surprise for them. They would also have time to measure any system health regressions if any.\n\nWith this perspective, I\u0027d love to not treat icu4j specially in derive_classpath.\n\nOne of the meaningful difference is that updatable jars are not part of DEX2OATBOOTCLASSPATH, and I believe that should stay the same.\n\nderive_classpath already knows to insert art jars above system, we can just add a glob pattern right betwen art and system. (or we could skip that and icu4j would come after system once it has its own config.)",
      "parentUuid": "feab2c41_73e23a85",
      "range": {
        "startLine": 9,
        "startChar": 31,
        "endLine": 9,
        "endChar": 58
      },
      "revId": "a2c831ccd614999ba5222f29e1db567c3de566e3",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "2e9015f8_5b597c92",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 2
      },
      "lineNbr": 0,
      "author": {
        "id": 1550939
      },
      "writtenOn": "2021-04-27T14:50:38Z",
      "side": 1,
      "message": "Adding Nicolas to verify that the relative order of boot jars in PRODUCT_BOOT_JARS doesn\u0027t matter.",
      "revId": "a2c831ccd614999ba5222f29e1db567c3de566e3",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "431328a2_3a9bf3e7",
        "filename": "target/product/default_art_config.mk",
        "patchSetId": 2
      },
      "lineNbr": 21,
      "author": {
        "id": 1550939
      },
      "writtenOn": "2021-04-27T14:50:38Z",
      "side": 1,
      "message": "Can you expand this comment to say that all apex boot jars must go before other (system or system_ext) jars, and why?",
      "range": {
        "startLine": 21,
        "startChar": 0,
        "endLine": 21,
        "endChar": 57
      },
      "revId": "a2c831ccd614999ba5222f29e1db567c3de566e3",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "50d46252_51b4e0ce",
        "filename": "target/product/default_art_config.mk",
        "patchSetId": 2
      },
      "lineNbr": 21,
      "author": {
        "id": 1061164
      },
      "writtenOn": "2021-04-27T15:08:42Z",
      "side": 1,
      "message": "That\u0027s not true actually, apex jars should generally go into PRODUCT_UPDATABLE_BOOT_JARS below. Ideally, ART_APEX_JARS would not be part of PRODUCT_BOOT_JARS, but for historic reasons they are. \n\nToday, PRODUCT_BOOT_JARS ordering matters because it defines relative ordering of /system/ jars in BCP, but I am trying to modularize that config, so as a follow up I\u0027ll add a special case for icu4j in derive_classpath to load after ART jars.\n\n(Unless we decide there is nothing special about icu4j and it should be part of all other normal apex jars.)",
      "parentUuid": "431328a2_3a9bf3e7",
      "range": {
        "startLine": 21,
        "startChar": 0,
        "endLine": 21,
        "endChar": 57
      },
      "revId": "a2c831ccd614999ba5222f29e1db567c3de566e3",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "e42db445_cbbb8324",
        "filename": "target/product/default_art_config.mk",
        "patchSetId": 2
      },
      "lineNbr": 21,
      "author": {
        "id": 1550939
      },
      "writtenOn": "2021-04-27T16:01:55Z",
      "side": 1,
      "message": "One correction: *updatable* apex jars should go in PRODUCT_UPDATABLE_BOOT_JARS. Non-updatable apex jars should go in PRODUCT_BOOT_JARS, like icu4j.",
      "parentUuid": "50d46252_51b4e0ce",
      "range": {
        "startLine": 21,
        "startChar": 0,
        "endLine": 21,
        "endChar": 57
      },
      "revId": "a2c831ccd614999ba5222f29e1db567c3de566e3",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    }
  ]
}