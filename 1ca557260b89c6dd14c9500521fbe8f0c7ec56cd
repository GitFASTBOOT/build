{
  "comments": [
    {
      "unresolved": true,
      "key": {
        "uuid": "9bd93ec2_890f3969",
        "filename": "core/board_config.mk",
        "patchSetId": 1
      },
      "lineNbr": 467,
      "author": {
        "id": 1080813
      },
      "writtenOn": "2021-09-29T15:50:17Z",
      "side": 1,
      "message": "Whether to build boot-debug.img isn\u0027t related to BOARD_USES_RECOVERY_AS_BOOT.\n\ne.g., we still boot-debug.img if BOARD_USES_RECOVERY_AS_BOOT is false, which means devices with a dedicated /recovery partition might still need a boot-debug.img.\n\nhttp://cs/android/build/make/core/Makefile;l\u003d2371;rcl\u003db8bdd8627bcf952205ff8538a6a0fccf02869100\n\nIt\u0027s more related to BOARD_BUILD_SYSTEM_ROOT_IMAGE, which means there is no ramdisk used in normal boot. The kernel will mount the system.img as root directly (and let init mount /vendor, /product, etc).\n\nhttps://source.android.com/compatibility/vts/vts-on-gsi#prerequisites_for_using_a_debug_ramdisk\n\nhttps://source.android.com/devices/tech/ota/ab/ab_implement#kernel (legacy info for Android P).\n\nhttps://source.android.com/devices/tech/ota/dynamic_partitions/implement#system-as-root-changes\n\nps: Thanks for cleaning it up!",
      "range": {
        "startLine": 467,
        "startChar": 14,
        "endLine": 467,
        "endChar": 41
      },
      "revId": "1ca557260b89c6dd14c9500521fbe8f0c7ec56cd",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "12d16786_8a79ad46",
        "filename": "core/board_config.mk",
        "patchSetId": 1
      },
      "lineNbr": 467,
      "author": {
        "id": 1337669
      },
      "writtenOn": "2021-09-30T06:15:06Z",
      "side": 1,
      "message": "thanks for pointing that out (BOARD_BUILD_SYSTEM_ROOT_IMAGE), I\u0027ll change that.\n\nOTOH, BOARD_USES_RECOVERY_AS_ROOT is needed due to (https://cs.android.com/android/_/android/platform/build/+/64bc620d8c8fb3c1c3908997d1ecc5f3f15504d4:core/Makefile)",
      "parentUuid": "9bd93ec2_890f3969",
      "range": {
        "startLine": 467,
        "startChar": 14,
        "endLine": 467,
        "endChar": 41
      },
      "revId": "1ca557260b89c6dd14c9500521fbe8f0c7ec56cd",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "31f69fea_1bdb1b1a",
        "filename": "core/board_config.mk",
        "patchSetId": 1
      },
      "lineNbr": 467,
      "author": {
        "id": 1080813
      },
      "writtenOn": "2021-09-30T06:26:47Z",
      "side": 1,
      "message": "Is there any specific line you want to mention for the above link?\n\nBOARD_USES_RECOVERY_AS_ROOT controls whether normal boot ramdisk and recovery ramdisk should co-exist in the /boot partition.\n\nBut it seems not relevant to whether a boot-debug.img should be generated?\n\ne.g.,\n1. no-ramdisk (\u0027skip_initramfs\u0027 in the kernel cmdline during normal boot) devices does not need boot-debug.img, even if BOARD_USES_RECOVERY_AS_ROOT is true.\n\n2. Ramdisk devices still need a boot-debug.img, even if BOARD_USES_RECOVERY_AS_ROOT is false (means they put the recovery kernel + ramdisk in the /recovery partition).",
      "parentUuid": "12d16786_8a79ad46",
      "range": {
        "startLine": 467,
        "startChar": 14,
        "endLine": 467,
        "endChar": 41
      },
      "revId": "1ca557260b89c6dd14c9500521fbe8f0c7ec56cd",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "a7f5a107_c87a023a",
        "filename": "core/board_config.mk",
        "patchSetId": 1
      },
      "lineNbr": 467,
      "author": {
        "id": 1337669
      },
      "writtenOn": "2021-09-30T06:30:31Z",
      "side": 1,
      "message": "oh right I missed copying the line number, here (https://cs.android.com/android/_/android/platform/build/+/64bc620d8c8fb3c1c3908997d1ecc5f3f15504d4:core/Makefile;l\u003d1847;drc\u003db7aced88d6ee1cbf9b9bd19756bb0616e88aa3c7)\n\nI think this means\n  BUILDING_RECOVERY_IMAGE \u0026\u0026 BOARD_USES_RECOVERY_AS_BOOT \u003d\u003e boot.img and boot-debug.img is built\n?",
      "parentUuid": "31f69fea_1bdb1b1a",
      "range": {
        "startLine": 467,
        "startChar": 14,
        "endLine": 467,
        "endChar": 41
      },
      "revId": "1ca557260b89c6dd14c9500521fbe8f0c7ec56cd",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "9bc0a990_f2214baf",
        "filename": "core/board_config.mk",
        "patchSetId": 1
      },
      "lineNbr": 467,
      "author": {
        "id": 1080813
      },
      "writtenOn": "2021-09-30T06:50:44Z",
      "side": 1,
      "message": "\u003e  BUILDING_RECOVERY_IMAGE \u0026\u0026 BOARD_USES_RECOVERY_AS_BOOT \u003d\u003e boot.img and boot-debug.img is built\n?\n\nIt seems to me that the following is enough:\n\n   if BOARD_BUILD_SYSTEM_ROOT_IMAGE is not true \u003d\u003e build boot-debug.img\n\nFor Android Pie launched devices, they have:\n 1. BOARD_BUILD_SYSTEM_ROOT_IMAGE is false --\u003e means \"no ramdisk\" is used in normal boot.\n 2. BOARD_USES_RECOVERY_AS_BOOT is true\n    2.1 Recovery mode uses boot.img \u003d\u003d kernel + recovery ramdisk\n    2.2 Normal boot: only the kernel from /boot is loaded (no ramdisk is used), and the kernel mounts system.img as root directly.  With CLs: https://android-review.googlesource.com/q/status:merged+project:kernel/common+branch:android-3.18+topic:A_B_Changes_3.18\n    \nBOARD_USES_RECOVERY_AS_BOOT only means if boot.img should be used in the recovery mode.\n\nBut BOARD_USES_RECOVERY_AS_BOOT doesn\u0027t not control whether a ramdisk is used in normal boot or not.\n\nIf no ramdisk will be used in normal boot, then there is no need to build boot-debug.img (because the debug ramdisk will not be loaded as well).\n\nhttps://source.android.com/devices/tech/ota/dynamic_partitions/implement#system-as-root-changes\n\nIn Android 10, the BOARD_BUILD_SYSTEM_ROOT_IMAGE flag is only used to differentiate whether the system is mounted by the kernel or by the first-stage init in ramdisk.    \n\n\nDoes that sound reasonable?",
      "parentUuid": "a7f5a107_c87a023a",
      "range": {
        "startLine": 467,
        "startChar": 14,
        "endLine": 467,
        "endChar": 41
      },
      "revId": "1ca557260b89c6dd14c9500521fbe8f0c7ec56cd",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "2203fc4f_ae57a12b",
        "filename": "core/board_config.mk",
        "patchSetId": 1
      },
      "lineNbr": 467,
      "author": {
        "id": 1337669
      },
      "writtenOn": "2021-09-30T06:57:21Z",
      "side": 1,
      "message": "but from the same page you referenced (https://source.android.com/devices/tech/ota/dynamic_partitions/implement#system-as-root-changes):\n\n\u003e When BOARD_USES_RECOVERY_AS_BOOT is set to true, the recovery image is built as boot.img, containing the recovery\u0027s ramdisk. Previously, bootloader used the skip_initramfs kernel command line parameter to decide which mode to boot into. For Android 10 devices, the bootloader MUST NOT pass skip_initramfs to the kernel command-line. Instead, bootloader should pass androidboot.force_normal_boot\u003d1 to skip recovery and boot normal Android.\n\nDoesn\u0027t this mean Android 10 devices with BOARD_USES_RECOVERY_AS_BOOT do uses the boot ramdisk for normal and recovery boot?",
      "parentUuid": "9bc0a990_f2214baf",
      "range": {
        "startLine": 467,
        "startChar": 14,
        "endLine": 467,
        "endChar": 41
      },
      "revId": "1ca557260b89c6dd14c9500521fbe8f0c7ec56cd",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "f063f363_bca61db7",
        "filename": "core/board_config.mk",
        "patchSetId": 1
      },
      "lineNbr": 467,
      "author": {
        "id": 1080813
      },
      "writtenOn": "2021-09-30T07:09:48Z",
      "side": 1,
      "message": "Right, but Android 10 devices without BOARD_USES_RECOVERY_AS_BOOT also uses the boot ramdisk for normal boot.\n\nI just felt odd for:\n\n  if BUILDING_RECOVERY_IMAGE \u0026\u0026 BOARD_USES_RECOVERY_AS_BOOT \u003d\u003e build boot-debug.img",
      "parentUuid": "2203fc4f_ae57a12b",
      "range": {
        "startLine": 467,
        "startChar": 14,
        "endLine": 467,
        "endChar": 41
      },
      "revId": "1ca557260b89c6dd14c9500521fbe8f0c7ec56cd",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "cfd0536b_c57d7bc8",
        "filename": "core/board_config.mk",
        "patchSetId": 1
      },
      "lineNbr": 467,
      "author": {
        "id": 1337669
      },
      "writtenOn": "2021-09-30T07:47:41Z",
      "side": 1,
      "message": "yeah so the logic handles both cases, building plain boot.img or building recovery.img-as-boot.img, ?\n\nI think I failed to understand your point, maybe we should just talk f2f?\n(plus I\u0027d like to keep this change a strict refactor (no-op), and changes that change the existing logic can go in a follow-up)",
      "parentUuid": "f063f363_bca61db7",
      "range": {
        "startLine": 467,
        "startChar": 14,
        "endLine": 467,
        "endChar": 41
      },
      "revId": "1ca557260b89c6dd14c9500521fbe8f0c7ec56cd",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "b7909367_0c26259e",
        "filename": "core/board_config.mk",
        "patchSetId": 1
      },
      "lineNbr": 467,
      "author": {
        "id": 1080813
      },
      "writtenOn": "2021-09-30T09:07:31Z",
      "side": 1,
      "message": "\u003e  and changes that change the existing logic can go in a follow-up)\n\nOK, agree with that.",
      "parentUuid": "cfd0536b_c57d7bc8",
      "range": {
        "startLine": 467,
        "startChar": 14,
        "endLine": 467,
        "endChar": 41
      },
      "revId": "1ca557260b89c6dd14c9500521fbe8f0c7ec56cd",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    }
  ]
}