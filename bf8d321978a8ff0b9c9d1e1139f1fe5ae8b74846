{
  "comments": [
    {
      "key": {
        "uuid": "a51fc46b_a04e978c",
        "filename": "tools/releasetools/build_image.py",
        "patchSetId": 2
      },
      "lineNbr": 752,
      "author": {
        "id": 1056365
      },
      "writtenOn": "2019-02-28T03:08:19Z",
      "side": 1,
      "message": "(I know it\u0027s from a past CL...) is there a real case for this path?",
      "range": {
        "startLine": 751,
        "startChar": 2,
        "endLine": 752,
        "endChar": 29
      },
      "revId": "bf8d321978a8ff0b9c9d1e1139f1fe5ae8b74846",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "efef5c6d_def80c3b",
        "filename": "tools/releasetools/build_image.py",
        "patchSetId": 2
      },
      "lineNbr": 752,
      "author": {
        "id": 1080813
      },
      "writtenOn": "2019-02-28T14:33:46Z",
      "side": 1,
      "message": "ok, not a problem to raise that, will fix here together.\n\nYup, it\u0027s from previous discussion. Agree it won\u0027t be a file anyway.\nhttps://android-review.googlesource.com/c/platform/build/+/890073/2/tools/releasetools/build_image.py#748",
      "parentUuid": "a51fc46b_a04e978c",
      "range": {
        "startLine": 751,
        "startChar": 2,
        "endLine": 752,
        "endChar": 29
      },
      "revId": "bf8d321978a8ff0b9c9d1e1139f1fe5ae8b74846",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "599def77_6e9c61db",
        "filename": "tools/releasetools/build_image.py",
        "patchSetId": 2
      },
      "lineNbr": 752,
      "author": {
        "id": 1080813
      },
      "writtenOn": "2019-03-19T11:31:17Z",
      "side": 1,
      "message": "This function is removed.",
      "parentUuid": "efef5c6d_def80c3b",
      "range": {
        "startLine": 751,
        "startChar": 2,
        "endLine": 752,
        "endChar": 29
      },
      "revId": "bf8d321978a8ff0b9c9d1e1139f1fe5ae8b74846",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "7543b2a8_f691e1d7",
        "filename": "tools/releasetools/build_image.py",
        "patchSetId": 2
      },
      "lineNbr": 800,
      "author": {
        "id": 1056365
      },
      "writtenOn": "2019-02-28T03:08:19Z",
      "side": 1,
      "message": "It doesn\u0027t look like the best place to have this call. And the fact that it modifies `in_dir` seems prone to broken. Because it sounds more natural to me to have build_image.py just building with the _given_ files, leaving the input dir intact. Have we considered writing this as a separate module (either .bp or .mk)? The module can then be depended on in the generic Makefile.\n\n(By doing that way, the generated file will also show up in installed-files.txt or installed-files-product.txt properly, which is currently missing.)",
      "range": {
        "startLine": 800,
        "startChar": 6,
        "endLine": 800,
        "endChar": 30
      },
      "revId": "bf8d321978a8ff0b9c9d1e1139f1fe5ae8b74846",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "c9b3bd1b_c627697b",
        "filename": "tools/releasetools/build_image.py",
        "patchSetId": 2
      },
      "lineNbr": 800,
      "author": {
        "id": 1056365
      },
      "writtenOn": "2019-02-28T03:23:01Z",
      "side": 1,
      "message": "Another concern with the current CL is that on devices w/o a separate /product partition, this code won\u0027t be called. But we should still expect the key to be available at /system/product/... instead.",
      "parentUuid": "7543b2a8_f691e1d7",
      "range": {
        "startLine": 800,
        "startChar": 6,
        "endLine": 800,
        "endChar": 30
      },
      "revId": "bf8d321978a8ff0b9c9d1e1139f1fe5ae8b74846",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "fcb7b37a_ed6d58fe",
        "filename": "tools/releasetools/build_image.py",
        "patchSetId": 2
      },
      "lineNbr": 800,
      "author": {
        "id": 1080813
      },
      "writtenOn": "2019-02-28T14:33:46Z",
      "side": 1,
      "message": "re: sounds more natural to me to have build_image.py just building with the _given_ files, leaving the input dir intact.\n\nYup, I tried to extract the public key in build/core/Makefile before.\nBut eventually build_image.py will also need to do it again, to extract the final release signing key specified in product_image_info.txt.\n\nBecause release signing will just invoke build_image.py without using .bp or .mk.\nSimilar to how we extract the public key for chain partition:\nhttps://android.googlesource.com/platform/build/+/8ff3fbdd08a266d1b7055338e3694a872d83dd8c/tools/releasetools/common.py#552\n\nI\u0027ll try to do it in some .bp or .mk, too.\nSo we can fix the issue of  installed-files.txt or installed-files-product.txt and /system/product/...\n\nThanks for the review!!",
      "parentUuid": "c9b3bd1b_c627697b",
      "range": {
        "startLine": 800,
        "startChar": 6,
        "endLine": 800,
        "endChar": 30
      },
      "revId": "bf8d321978a8ff0b9c9d1e1139f1fe5ae8b74846",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "d1da4502_8d3086e2",
        "filename": "tools/releasetools/build_image.py",
        "patchSetId": 2
      },
      "lineNbr": 800,
      "author": {
        "id": 1056365
      },
      "writtenOn": "2019-02-28T18:41:16Z",
      "side": 1,
      "message": "Re: release signing\nyeah, this is the other piece that we need to handle. We have to specify the release signing key for system_other when calling sign_target_files_apks.py: https://android-review.googlesource.com/c/platform/build/+/913493/2/tools/releasetools/sign_target_files_apks.py#89.\n\nThe current CL will try to read the key from the global info_dict (i.e. the one in input target_files), instead of the one specified via commandline. We should also remove / skip the file while processing the input target_files, similar to https://android-review.googlesource.com/c/platform/build/+/913493/2/tools/releasetools/sign_target_files_apks.py#384. Then call this ExtractSystemOtherAvbKey() later on to place the new key. Will have to duplicate the logic in Makefile (or .bp) as well as in python script, in order to avoid modifying the inputs in build_image.py.",
      "parentUuid": "fcb7b37a_ed6d58fe",
      "range": {
        "startLine": 800,
        "startChar": 6,
        "endLine": 800,
        "endChar": 30
      },
      "revId": "bf8d321978a8ff0b9c9d1e1139f1fe5ae8b74846",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "149f41fd_ea023a6f",
        "filename": "tools/releasetools/build_image.py",
        "patchSetId": 2
      },
      "lineNbr": 800,
      "author": {
        "id": 1080813
      },
      "writtenOn": "2019-03-04T08:47:16Z",
      "side": 1,
      "message": "OK, thanks for the info. I incorrectly thought release signing was extracted in build_image.py.\n\nWill check related source later (will be busy in b/126493225 these days).",
      "parentUuid": "d1da4502_8d3086e2",
      "range": {
        "startLine": 800,
        "startChar": 6,
        "endLine": 800,
        "endChar": 30
      },
      "revId": "bf8d321978a8ff0b9c9d1e1139f1fe5ae8b74846",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "ecbab2b1_59530a25",
        "filename": "tools/releasetools/build_image.py",
        "patchSetId": 2
      },
      "lineNbr": 800,
      "author": {
        "id": 1080813
      },
      "writtenOn": "2019-03-19T11:31:17Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "149f41fd_ea023a6f",
      "range": {
        "startLine": 800,
        "startChar": 6,
        "endLine": 800,
        "endChar": 30
      },
      "revId": "bf8d321978a8ff0b9c9d1e1139f1fe5ae8b74846",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    }
  ]
}