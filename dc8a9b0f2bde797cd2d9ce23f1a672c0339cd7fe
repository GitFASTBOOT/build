{
  "comments": [
    {
      "unresolved": false,
      "key": {
        "uuid": "00c8b3ee_8f55baab",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1290458
      },
      "writtenOn": "2021-09-21T05:17:25Z",
      "side": 1,
      "message": "Can you describe how to reproduce this issue? I don\u0027t see any assertion when testing with erofs.",
      "revId": "dc8a9b0f2bde797cd2d9ce23f1a672c0339cd7fe",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "3f97bf07_ab41dcca",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1895975
      },
      "writtenOn": "2021-09-21T14:21:08Z",
      "side": 1,
      "message": "This issue occurred when I backported EROFS to a non-A/B device running Android 11. (didn\u0027t encounter this on A/B variant)\nAfter all, the reason in commitmsg should be enough justification.",
      "revId": "dc8a9b0f2bde797cd2d9ce23f1a672c0339cd7fe",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "f8f002cf_6ec1785d",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1290458
      },
      "writtenOn": "2021-09-22T00:32:09Z",
      "side": 1,
      "message": "I\u0027d prefer to keep the assert (or to make it non-AB only), since a missing block map would be pretty serious for an AB update. erofs-utils has blockmap support upstream which we\u0027ll pull in when 1.4 is ready. But I\u0027ll defer to OTA folks.",
      "revId": "dc8a9b0f2bde797cd2d9ce23f1a672c0339cd7fe",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "bded1ec5_72d0def1",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1121838
      },
      "writtenOn": "2021-09-22T01:03:50Z",
      "side": 1,
      "message": "+1.\n\nSome alternatives I\u0027d suggest:\n- Add system.map for erofs / squashfs\n- As David suggests, allow it to be missing only for non-A/B\n- Allow them to be missing only for non-A/B and (erofs or squashfs)",
      "parentUuid": "f8f002cf_6ec1785d",
      "revId": "dc8a9b0f2bde797cd2d9ce23f1a672c0339cd7fe",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "5ed501eb_2c5145ea",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1710792
      },
      "writtenOn": "2021-09-22T01:04:25Z",
      "side": 1,
      "message": "have you tested the OTA sizes with this patch? Missing block map + using compressed filesystem is probably going to increase OTA size by 2x or 3x. Are you sure you want this?",
      "parentUuid": "3f97bf07_ab41dcca",
      "revId": "dc8a9b0f2bde797cd2d9ce23f1a672c0339cd7fe",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "e77162ef_02e26eca",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1710792
      },
      "writtenOn": "2021-09-22T01:14:36Z",
      "side": 1,
      "message": "These two functions are only executed for non-AB, so no impact on AB devices.\n\nBut this CL feels like it\u0027s attacking the symptom rather than the problem. We did some experiments running erofs on AB devices, and even with proper block map support there\u0027s still a significant impact on OTA sizes(David can you share the numbers if possible?). Running EROFS w/o block map is just going to kill OTA size(2x-3x I remember?). I don\u0027t think silencing missing block map errors is a good solution.",
      "parentUuid": "bded1ec5_72d0def1",
      "revId": "dc8a9b0f2bde797cd2d9ce23f1a672c0339cd7fe",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "424b2038_aa72fba3",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1895975
      },
      "writtenOn": "2021-09-22T02:43:52Z",
      "side": 1,
      "message": "Thanks for your kind reply, and I agree with all the points above. This patch should be abandoned.",
      "revId": "dc8a9b0f2bde797cd2d9ce23f1a672c0339cd7fe",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "9d1bab07_44793ec8",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1639124
      },
      "writtenOn": "2021-09-22T03:06:24Z",
      "side": 1,
      "message": "btw, once (2 years before) we had some in-house optimization for OTA size (including optimization for full and difference), using some recompress way to reduce diff amplification.\n\nYet my previous employer would like to avoid sharing this due to that is unrelated to the EROFS filesystem core and a separated runtime program, hmmm....",
      "parentUuid": "e77162ef_02e26eca",
      "revId": "dc8a9b0f2bde797cd2d9ce23f1a672c0339cd7fe",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "7832768f_f76f8306",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1710792
      },
      "writtenOn": "2021-09-22T03:16:42Z",
      "side": 1,
      "message": "AOSP\u0027s imgdiff and puffdiff will decompress input bytes, perform diffing, and re-compress back. Not sure if you\u0027ve tried those.",
      "parentUuid": "9d1bab07_44793ec8",
      "revId": "dc8a9b0f2bde797cd2d9ce23f1a672c0339cd7fe",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "360c54d1_fabb354a",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1639124
      },
      "writtenOn": "2021-09-22T03:20:35Z",
      "side": 1,
      "message": "nope, I don\u0027t have any expertise in the Android OTA field, it was developed my another team at that time.\n\nFor the full OTA package, since EROFS is lz4 compressed, so recompressing again with XZ format (the AOSP way, but my previous company does\u0027t use XZ since it impacts total upgrading time without A/B) would not get much gain compared with XZ with plain data directly.\n\nOne final solution of this might be support generating target EROFS images from XZ tarball with a fs tree directly in the device, plus mkfs fully supports reproducable builds. I don\u0027t have enough extra time working on this, mainly working on container use cases for now, but it\u0027s still on my TODO list.",
      "parentUuid": "7832768f_f76f8306",
      "revId": "dc8a9b0f2bde797cd2d9ce23f1a672c0339cd7fe",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    }
  ]
}