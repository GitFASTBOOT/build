{
  "comments": [
    {
      "key": {
        "uuid": "b7a3b5a7_7b78c43a",
        "filename": "target/board/BoardConfigGsiCommon.mk",
        "patchSetId": 14
      },
      "lineNbr": 46,
      "author": {
        "id": 1080813
      },
      "writtenOn": "2019-04-11T06:40:49Z",
      "side": 1,
      "message": "forgot to remove?\n\nJust to be clear, in AVB, dm-verity will be enabled for all variants (including eng).\nSo we can probably add --flag 2 unconditionally here.",
      "range": {
        "startLine": 46,
        "startChar": 0,
        "endLine": 46,
        "endChar": 46
      },
      "revId": "6055b432f10bc1aaa9c3ece5145288a056f144a1",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "4356bb3a_c7094019",
        "filename": "target/board/BoardConfigGsiCommon.mk",
        "patchSetId": 14
      },
      "lineNbr": 46,
      "author": {
        "id": 1046320
      },
      "writtenOn": "2019-04-11T17:12:41Z",
      "side": 1,
      "message": "Bowgo,\n   --flag 2 actually disables it completely. \n\n[    1.196046] init: [libfs_mgr]Created logical partition system on device /dev/block/dm-0\n[    1.209143] init: [libfs_mgr]Created logical partition vendor on device /dev/block/dm-1\n[    1.215651] init: [libfs_avb]Returning avb_handle with status: VerificationDisabled\n[    1.218229] init: [libfs_avb]AVB HASHTREE disabled on: /system\n\nIIUC, you want the flag to be just 0 (enforcing) for all the build variant, right ?",
      "parentUuid": "b7a3b5a7_7b78c43a",
      "range": {
        "startLine": 46,
        "startChar": 0,
        "endLine": 46,
        "endChar": 46
      },
      "revId": "6055b432f10bc1aaa9c3ece5145288a056f144a1",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "2dc5a1bd_019add92",
        "filename": "target/board/BoardConfigGsiCommon.mk",
        "patchSetId": 14
      },
      "lineNbr": 46,
      "author": {
        "id": 1080813
      },
      "writtenOn": "2019-04-12T00:24:17Z",
      "side": 1,
      "message": "Oh, I see. \nI preferred --flag 2 for all variants, but now I think it probably can be 0 (enforcing) for all variants. (the bottom line is, all build variants should have the same setting).\n\nIn P and before, when OEM devices use GSI, it has to disable verity (i.e., with --flag 2).\nBecause we didn\u0027t sign GSI and init/fs_mgr doesn\u0027t have the ability to verify a \"standalone\" partition in an OEM device (where GSI\u0027s vbmeta isn\u0027t in /vbmeta).\n\nFor emulator side in P:\n   - vbmeta.img isn\u0027t used\n   - system-as-root\n   - Emulator has a script to extract \"system-as-root\" dm-verity params from vbmeta.img (and ignores the --flag 2), then pass it to kernel cmdline to enable dm-verity (for kernel to mount system.img as root).\n\nThat\u0027s how --flag 2 and having dm-verity on emulator co-exist in P.\n\n\nIn Q, we can support AVB for a standalone partition like GSI.\n - Emulator uses vbmeta.img, thus it can\u0027t have --flag 2.\n - In Q, GSI needs to be run with dm-verity, so we probably don\u0027t need --flag 2 as well\n\nLet\u0027s see how Szuwei think about it, as in current GSI release process, we always include a --flag 2 vbmeta.img in the .zip file.",
      "parentUuid": "4356bb3a_c7094019",
      "range": {
        "startLine": 46,
        "startChar": 0,
        "endLine": 46,
        "endChar": 46
      },
      "revId": "6055b432f10bc1aaa9c3ece5145288a056f144a1",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "b6c0f61d_58d96e20",
        "filename": "target/board/BoardConfigGsiCommon.mk",
        "patchSetId": 14
      },
      "lineNbr": 46,
      "author": {
        "id": 1046320
      },
      "writtenOn": "2019-04-12T00:31:27Z",
      "side": 1,
      "message": "the only reason I want to keep --flag 2 for eng build is for framework\ndevelopment in build environment because \u0027adb disable-verity\u0027 does not\nwork on emulator(for lack of bootloader to re-calculate the vbmeta digets,\nas mentioned in the bug). so a compromise, how about \nremove --flag 2 from Gsi mk file but add --flag 2 in emu mk file for\neng build only ( I still want userdebug to have --flag 0)\n\nwhat do you think ?",
      "parentUuid": "2dc5a1bd_019add92",
      "range": {
        "startLine": 46,
        "startChar": 0,
        "endLine": 46,
        "endChar": 46
      },
      "revId": "6055b432f10bc1aaa9c3ece5145288a056f144a1",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": true
    }
  ]
}