{
  "comments": [
    {
      "unresolved": false,
      "key": {
        "uuid": "a50fcf95_3daeadbf",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1703091
      },
      "writtenOn": "2020-12-08T02:58:00Z",
      "side": 1,
      "message": "Site note: I don\u0027t know what\u0027s the exact benefit of this.\n\nI have to say the default 16k f2fs compression (not matter what algorithm, even with Zstd) is _much_ bigger than erofs 4k compression, plus unnecessary metadata overhead (especially NAT+SSA).\n\nNot to mention its random read I/O amplification and memory footprint for now.",
      "revId": "17d10de0f321d31d5fe1fd05ce81432e3fa56003",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "a9c3ad27_cdc532c6",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1176763
      },
      "writtenOn": "2020-12-08T06:10:30Z",
      "side": 1,
      "message": "This is evaluation purpose, and we\u0027re planning to support a read-only compressed image without metadata overhead.",
      "parentUuid": "a50fcf95_3daeadbf",
      "revId": "17d10de0f321d31d5fe1fd05ce81432e3fa56003",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "8291cdd0_2efbd182",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1176763
      },
      "writtenOn": "2020-12-08T06:10:30Z",
      "side": 1,
      "message": "These require f2fs-tools update tho, device.mk/fstab",
      "revId": "17d10de0f321d31d5fe1fd05ce81432e3fa56003",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "6434f76a_7566b241",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1703091
      },
      "writtenOn": "2020-12-08T06:17:29Z",
      "side": 1,
      "message": "Hi Jaegeuk,\n\nThanks for your reply, since uncompressed f2fs can catch extent_cache, but compressed files not. And the f2fs node amplification is noticable (compared with ext4 extent or f2fs extent cache) as well. By constant, erofs uses compacted index, it doesn\u0027t have indirect block and each block only uses 2byte meta index.\n\nAnd if you look at rand9m in\nhttps://github.com/erofs/erofs-openbenchmark/wiki/linux_5.10_rc4-compression-FSes-benchmark\n\nIt will become largely with the larger cluster size (and make UFS just as a eMMC), and I don\u0027t think it can be eliminated by just cache compressed blocks (see squashfs data.)\n\nBy design, fixed-sized output 4k can have the minimum random I/O amplification.\n\nThanks,\nGao Xiang",
      "parentUuid": "a9c3ad27_cdc532c6",
      "revId": "17d10de0f321d31d5fe1fd05ce81432e3fa56003",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "650fb31a_72a505ca",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1703091
      },
      "writtenOn": "2020-12-08T06:25:08Z",
      "side": 1,
      "message": "\u003e Hi Jaegeuk,\n\u003e \n\u003e Thanks for your reply, since uncompressed f2fs can catch extent_cache, but compressed files not. And the f2fs node amplification is noticable (compared with ext4 extent or f2fs extent cache) as well. By constant, erofs uses compacted index, it doesn\u0027t have indirect block and each block only uses 2byte meta index.\n\u003e \n\u003e And if you look at rand9m in\n\u003e https://github.com/erofs/erofs-openbenchmark/wiki/linux_5.10_rc4-compression-FSes-benchmark\n\u003e \n\u003e It will become largely with the larger cluster size (and make UFS just as a eMMC), and I don\u0027t think it can be eliminated by just cache compressed blocks (see squashfs data.)\n\u003e \n\u003e By design, fixed-sized output 4k can have the minimum random I/O amplification.\n\u003e \n\u003e Thanks,\n\u003e Gao Xiang\n\nAlso, on-disk erofs format is quite optimized for Android read-only scenarios (this is just on-disk changes, plus inplace decompression runtime optimization (to avoid double memory footprint), I don\u0027t see there\u0027s any chance with the current f2fs on-disk compression design.)\n\nThanks for your time.\n\nThanks,\nGao Xiang",
      "parentUuid": "6434f76a_7566b241",
      "revId": "17d10de0f321d31d5fe1fd05ce81432e3fa56003",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "e3bf50fb_2ae1f6ce",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1176763
      },
      "writtenOn": "2020-12-08T06:27:02Z",
      "side": 1,
      "message": "Hi Xiang, thank you for sharing your insights. We\u0027ll evaluate performance as well as space reduction as you concerned. :)",
      "parentUuid": "650fb31a_72a505ca",
      "revId": "17d10de0f321d31d5fe1fd05ce81432e3fa56003",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "ddd4f96d_b2c0e7d9",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1703091
      },
      "writtenOn": "2020-12-08T06:29:40Z",
      "side": 1,
      "message": "Hi Jaegeuk, Yeah, I think f2fs compression is good, but EROFS is designed and heavily optimized for read-only scenarios (from on-disk index and runtime), but I\u0027m not sure if f2fs compression does like that, the modification and the complexity are worthwhile...",
      "parentUuid": "e3bf50fb_2ae1f6ce",
      "revId": "17d10de0f321d31d5fe1fd05ce81432e3fa56003",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "c38d5b3a_74773016",
        "filename": "tools/releasetools/build_image.py",
        "patchSetId": 1
      },
      "lineNbr": 361,
      "author": {
        "id": 1290458
      },
      "writtenOn": "2020-12-08T17:58:14Z",
      "side": 1,
      "message": "nit: spaces around \u003d, eg:\n\n        sldc_flags_str \u003d prop_dict.get(\"system_f2fs_sldc_flags\")\n        sldc_flags \u003d sldc_flags_str.split()",
      "revId": "17d10de0f321d31d5fe1fd05ce81432e3fa56003",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "65da7cb9_98cf45f1",
        "filename": "tools/releasetools/build_image.py",
        "patchSetId": 1
      },
      "lineNbr": 364,
      "author": {
        "id": 1290458
      },
      "writtenOn": "2020-12-08T17:58:14Z",
      "side": 1,
      "message": "You can replace this for loop with:\n\n    build_command.extend(sldc_flags)",
      "revId": "17d10de0f321d31d5fe1fd05ce81432e3fa56003",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    }
  ]
}